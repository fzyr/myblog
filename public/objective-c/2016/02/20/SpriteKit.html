<!DOCTYPE html>
<html lang = "en">
<head>
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/posts/favico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/posts/favico/favico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/posts/favico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/posts/favico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/posts/favico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/posts/favico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/posts/favico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/posts/favico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/posts/favico/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/posts/favico/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/posts/favico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/posts/favico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/posts/favico/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/posts/favico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/images/posts/favico/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">   

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/font-awesome/css/font-awesome.min.css">
    <link href="/assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>
<!--     <script type="text/javascript" src="http://api.youziku.com/webfont/FastJS/yzk_976E121ED7CC0870"></script> -->

    <title>SHUNMIAN</title>
</head>


<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 sidebar hidden-xs sidebar">
                
<!--sidebar.html-->
        <header class="sidebar_header " role="banner">
            <a href="http://www.shunmian.me/index.html">
                <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df?s=150" class="img-circle img-responsive center-block sidebar_logo sidebar_img" />
            </a>


            <h3 class="title text-center">
                <a href="http://www.shunmian.me/index.html">SHUNMIAN</a>
            </h3>

        </header>


        <hr class="hr_short"/>
        <div id = "bio" class="text-center sidebar_bio">
            

                <p>嗨，欢迎来到我的博客。<br/>
                我是Shunmian，一名iOS开发者。<br/>
                <hr class = "hr_short_low">
                正在学习Algorithm，Functional Programming，Machine Learning，Data Mining 和 Cloud Computation。 

                </p>

            
        </div>


        <hr class="hr_middle"/>
        <div id = "contact-list" class="text-center">
            <ul class="list-unstyled list-inline">
                <li>
                    
                    <a class="btn btn_info_outline" href="mailto:shunmian@gmail.com"><i class="fa fa-envelope fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-github fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-twitter fa-lg"></i></a>
                    
                </li>

                <li>
                    <a class="btn btn_info_outline" href="http://www.shunmian.me/feed.xml"><i class="fa fa-rss fa-lg"></i></a>
                </li>
        </div>


        <hr class="hr_short"/>
        <div id = "contact-list" class="text-center">
            <ul class="unstyled-list list-inline">
                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/index.html"><i class="fa fa-home fa-md"></i> 主页</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/tags.html"><i class="fa fa-tags fa-md"></i> 标签</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/categories.html"><i class="fa fa-list fa-md"></i> 分类</a>
                </li>
            </ul>
        </div>
        <div class="padding_bottom_500"></div>




<!--sidebar.html end-->

            </div>

            <div class="col-sm-9 col-sm-offset-3">
                

<div class="page-header col-sm-10 col-sm-offset-1">
    <h1 class="article_mainTitle">iOS 2D Game - SpriteKit入门(一) </h1>
    <span class="post_date">
        2016-02-20 •
    </span>
    <span class="post_category">
        Objective-C
    </span>
</div>

<article class="article">
    <div class="col-sm-10 col-sm-offset-1">
        <div class="article_mainBody">
            <p class="article_content_title">目录</p>

<ul id="markdown-toc">
  <li><a href="#spritekit-" id="markdown-toc-spritekit-">1. SpriteKit 概览</a></li>
  <li><a href="#sknodeskphysicsworld--skphysicsbodyskaction" id="markdown-toc-sknodeskphysicsworld--skphysicsbodyskaction">2. SKNode，SKPhysicsWorld &amp; SKPhysicsBody，SKAction理解</a>    <ul>
      <li><a href="#skscene" id="markdown-toc-skscene">2.1.1 SKScene</a></li>
      <li><a href="#skspritenode" id="markdown-toc-skspritenode">2.1.2 SKSpriteNode</a></li>
      <li><a href="#sklabelnode" id="markdown-toc-sklabelnode">2.1.3 SKLabelNode</a></li>
      <li><a href="#skemitternode" id="markdown-toc-skemitternode">2.1.4 SKEmitterNode</a></li>
      <li><a href="#skphysicsworld--skphysicsbody" id="markdown-toc-skphysicsworld--skphysicsbody">2.2 SKPhysicsWorld &amp; SKPhysicsBody</a>        <ul>
          <li><a href="#skphysicsworld" id="markdown-toc-skphysicsworld">2.2.1 SKPhysicsWorld</a></li>
          <li><a href="#skphysicsbody" id="markdown-toc-skphysicsbody">2.2.2 SKPhysicsBody</a></li>
        </ul>
      </li>
      <li><a href="#skaction" id="markdown-toc-skaction">2.3. SKAction</a></li>
    </ul>
  </li>
  <li><a href="#section" id="markdown-toc-section">3.其它类</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">4 总结</a></li>
</ul>

<hr class="hr-short-left" />

<h2 id="spritekit-">1. SpriteKit 概览</h2>

<p>SpriteKit是Apple官方的2D游戏框架， 让开发者在iOS 和OS 平台上更高效的开发2D游戏。</p>

<p>学习SpriteKit， 最权威的资料应该是苹果官方文档 -
<a href="https://developer.apple.com/library/ios/documentation/GraphicsAnimation/Conceptual/SpriteKit_PG/Introduction/Introduction.html">SpriteKit Programming Guide</a>。 该文档很全面但是不适合初学者。 对于初学者， 理解SpriteKit背后的设计rationale才能更好的应用它。 那么SpriteKit的设计rationale是什么呢？</p>

<p>对于一个2D游戏来说， 设计应该分为三个部分(以超级马里奥为例):</p>

<ol>
  <li>View: 即视图显示，用于展示各个Sprite(精灵)，例如马里奥图片和子弹图片;</li>
  <li>Physics Model:即物理模型， 包括质量， 体积(2D游戏是面积)， 密度， 碰撞， 地球引力等， 例如超级马里奥碰到水管会弹回来， 往上跳会下落。</li>
  <li>Action:即 物理模型受到的外部作用力。例如超级马里奥里的空中台阶自己来回移动(开发者给其施加一个永恒的来回运动的作用力)。</li>
</ol>

<p>这三个方面分别对应SpriteKit里面的SKNode，SKPhysicsWorld &amp; SKPhysicsBody，SKAction。</p>

<h2 id="sknodeskphysicsworld--skphysicsbodyskaction">2. SKNode，SKPhysicsWorld &amp; SKPhysicsBody，SKAction理解</h2>
<p>### 2.1 SKNode###</p>

<p>SKNode 是 SpriteKit 显示视图的Building Block。它能提供一个游戏视图的基本属性和方法:</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre>SKNode Class

属性:
.zPosition              // 视图的z方向的距离，用于标定重叠视图的显示顺序;
.xScale                 // x方向的视图放大倍数;
.yScale                 // y方向的视图放大倍数;
.alpha                  // 视图的alpha值;
.hidden                 // 视图是否隐藏;

方法:
-addChild:              // 增加子SKNode，与UIView 的 -addSubView: 类似;
-removeFromParent:      // 从父SKNode移除，与 UIView的removeFromSuperview 类似;
-runAction:             // 运行一个SKAction;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>我们一般不直接用它，它下面有几个子类，其中最常见的是以下4个:</p>

<ul>
  <li>SKEffectNode: 用于缓存，渲染，加滤镜于图片。它的子类SKScene 用于展示所有的SKNode，是游戏场景;</li>
  <li>SKSpriteNode: 用于展示精灵，如超级马里奥图片;</li>
  <li>SKLabelNode: 用于展示单行文本，如游戏时间;</li>
  <li>SKEmitterNode: 用于展示粒子，例如喷射火焰的岩浆;</li>
</ul>

<p>下面我们就这四个类做一个简单的介绍。</p>

<h4 id="skscene">2.1.1 SKScene</h4>
<p>SKScene 是游戏关口(level)，游戏中的一个场景，例如马里奥的第一关和第二关分别是两个SKCene实例。在这个场景中，包含了所有其他SKNode(或者其子类)，比如马里奥(SKSpriteNode)，游戏时间(SKLabelNode)，喷射火焰的岩浆(SKEmitterNode)。它的主要属性和方法有:</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>SKScene Class

属性:
.view                   // 关口的父视图，是一个SKView，用来展示各个SKScene关口;
.physicsWorld           // 世界的物理模型，是一个SKPhysicsWorld实例，这个后面会介绍;

方法:
-initWithSize:          // 初始化方法;
+SceneWithSize:         // 初始化类工厂方法;
-didMoveToView:         // 当SKScene实例被SKView展示时调用，类似UIView的-didMoveToSuperview;
-addChild:              // 增加子SKNode，如马里奥(SKSpriteNode);<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="skspritenode">2.1.2 SKSpriteNode</h4>
<p>SKSpriteNode是用来展示sprite，那么何为sprite呢，sprite有什么作用呢? Wiki中是这样定义的。</p>

<blockquote>
  <p>sprite: two-dimensional image or animation that is integrated into a larger scene.Initially including just graphical objects handled <strong>separately</strong> from the memory bitmap of a video display，this now includes various manners of graphical overlays.</p>
</blockquote>

<p>sprite是从整个display独立出来渲染的2D图片。如何理解这句话呢，在sprite出现之前，2D游戏要渲染一帧图片(比如马里奥在一个蓝天白云的背景前)，需要把整个图片(马里奥+背景)计算完后再渲染，其中背景的渲染在每一帧中都重复。sprite的出现正是为了避免这一重复。马里奥是一个sprite，他在一个固定的背景前跳跃，只需要将马里奥的每一帧渲染出来叠在背景(背景不需要重复计算渲染)即可，这就是为什么sprite被称为从整个display独立出来渲染的2D图片。sprite的思想在几十年前就已经有了，SpriteKit只是沿袭了2D游戏设计中运用sprite这一思想，用SKSpriteNode来表示sprite类。我们来看下SKSpriteNode的属性和方法</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>SKSpriteNode Class

属性:
.size                       // 大小;
.physicsBody                // 物体的物理模型，是一个SKPhysicsBody实例，这个后面会介绍;

方法:
+spriteNodeWithImageNamed:  // 类工厂方法，用图片创建sprite;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="sklabelnode">2.1.3 SKLabelNode</h4>
<p>SKLabelNode是SpriteKit用来展示text，它的方法和属性如下。有一点需要注意的是它只能显示单行文本。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>SKLabelNode Class

属性:
.fontSize               // 字体大小;
.color                  // 字体颜色;
.fontName               // 字体名字;

方法:
-initWithFontNamed:     // 通过字体名字初始化方法;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="skemitternode">2.1.4 SKEmitterNode</h4>
<p>SKEmitterNode是SpriteKit用来展示粒子系统的，下面介绍下它的常见使用方法。</p>

<ol>
  <li>
    <p>subclass一个SpriteKit Particles Files ( ctrl + N –&gt; iOS，Resources，SpriteKit Particles Files –&gt; choose 1 of the eight template –&gt; save，你会得到一个.sks 和.png 文件，点击.sks文件:</p>

    <p><img src="/assets/images/posts/2016-02-20/SKEmitterNode_1.png" alt="SKEmitterNode_1" />
 <img src="/assets/images/posts/2016-02-20/SKEmitterNode_2.png" alt="SKEmitterNode_2" />
 <img src="/assets/images/posts/2016-02-20/SKEmitterNode_3.png" alt="SKEmitterNode_3" />
 <img src="/assets/images/posts/2016-02-20/SKEmitterNode_4.png" alt="SKEmitterNode_4" /></p>
  </li>
  <li>在.sks文件右侧调整各参数，例如有粒子平均产生率(BirthRate) 单位是个/秒。右边的range是一个分布，在平均产生率上 ±  range/2 分布。particle texture 是粒子的纹路，你可以选择自己加入的图片文件。</li>
  <li>调整完成后如何在code中调用.sks文件呢:</li>
</ol>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="n">SKEmitterParticle</span> <span class="o">*</span> <span class="n">fireParticles</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSKeyedUnarchiver</span> <span class="nf">unarchiveObjectWithFile</span><span class="p">:[[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]</span> <span class="nf">pathForResource</span><span class="p">:</span><span class="s">@"FireParticle"</span> <span class="nf">ofType</span><span class="p">:</span><span class="s">@"sks"</span><span class="p">]];</span>

<span class="n">fireParticles</span><span class="p">.</span><span class="n">particleBirthRate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">fireParticles</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">);</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code> 用NSBundle读取.sks 文件，然后可以进一步修改其属性。这样就完成了SpriteKit Particles Files 的子类化和应用。
</code></pre>
</div>

<h3 id="skphysicsworld--skphysicsbody">2.2 SKPhysicsWorld &amp; SKPhysicsBody</h3>
<p>SpriteKit 里表示物理模型的有两个类，SKPhysicsWorld &amp; SKPhysicsBody，前者属于SKScene，后者属于SKNode其他子类。SKPhysicsWorld 和 SKPhysicsBody 都继承与NSObject。我们先来看看SKPhysicsWorld。</p>

<h4 id="skphysicsworld">2.2.1 SKPhysicsWorld</h4>
<p>对于一个物理世界来说，例如我们的地球，有一些属性决定了我们日常生活的基础，如重力加速度。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>SKPhysicsWorld Class

属性:
.gravity:                   // 重力加速度了， 通过CGVectorMaker(0，-9.8)获得现实生活一个重力加速度。第一个参数是x轴，向右为正，第二个参数是y轴，向上为正;
.contactDelegate            // SKPhyicsContactDelegate 实例;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>又比如物体碰撞后的处理者，可以理解为物体碰撞后有一个裁判需要对此进行处理，在SpriteKit中是SKPhyicsContactDelegate。而SKPhysicsWorld 的contactDelegate属性就指向这样一个delegate，也就是说由物理世界充当裁判的角色。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>SKPhysicsContactDelegate Class

方法:
-didBeginContact:       // 碰撞开始;
-didEndContact:         // 碰撞结束;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>对于SKPhysicsContactDelegate两个方法的使用我们后面介绍。</p>

<h4 id="skphysicsbody">2.2.2 SKPhysicsBody</h4>
<p>SKPhysicsBody代表物理模型里的物体，它有质量，体积(2D 游戏里是面积)，密度，线速度，角速度，自旋速度等。</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre>SKPhysicsBody Class

属性:
.mass                       // 质量，单位kg;
.area                       // 面积，单位m*m;
.density                    // 密度，单位kg/m*m;
.friction                   // 表面粗糙度，0.0-1.0;
.restitution                // 碰撞时，反射速度/入射速度，0.0-1.0;
.linearDamping              // 物体线速度受液体或者气体(空气)摩擦的影响， 0.0-1.0;
.dynamic                    // YES，动态; NO，静态，与SKPhysicsWorld相连，不受碰撞影响;
.categoryBitMask            // 自身的contact &amp; collision ID;
.contactTestBitMask         // 外界contact测试的ID集合;
.collisionBitMask           // 外界collision的ID集合;

方法:
+bodyWithRectangleOfSize:   // 创建Volume-physicsBody的一种类工厂方法;
+bodyWithEdgeLoopFromRect:  // 创建Edge-physicsBody的一种类工厂方法;
-applyImpulse:              // 被施加外部瞬时力;
-applyForce:                // 被施加外部永恒力;
-runAction:                 // 运行一个SKAction实例;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>.dynamics 是一个BOOL，设置为NO时，静止(可以理解为与SKPhyisicsWorld相连)，位置不受碰撞前后影响， 例如马里奥里的乌龟壳，碰到水管后反弹，水管静止，这里水管的dynamic就是NO， 乌龟壳的dynmaics就是YES。</p>

<p>要创建一个在框里永远碰撞而不停下的ball，应设置如下friction，restituition， linearDamping:</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">ball</span><span class="p">.</span><span class="n">friction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">ball</span><span class="p">.</span><span class="n">restitution</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">ball</span><span class="p">.</span><span class="n">linearDamping</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>SKPhysicsBody的创建分为两种，一种是Volume-physicsBody，就是有体积(2D里是面积)的物体，有体积意味着有质量，受牛顿定律影响;另一种是只有边缘没有体积的Edge-physicsBody，如上面那个装永动球的箱子，我们只关心箱子的边框，用 +bodyWithEdgeLoopFromRect: 创建它并设置其dynamics = NO 即可。</p>

<p>下面重点要介绍的是接触和碰撞。
SpriteKit为每个物体在接触和碰撞时设定了一个身份证——categoryBitMask，该属性唯一标定了接触和碰撞时每个物体的身份，是一个32 bit的数，我们下面先看code再解释:</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">MariaCategory</span>              <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">TortoiseCategory</span>           <span class="o">=</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">BulletCategory</span>             <span class="o">=</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>我们设置了3种uint32_t的静态常量，分别代表马里奥，子弹，乌龟。</p>

<figure class="highlight"><pre><code class="language-objec" data-lang="objec"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>maria.categoryBitMask = MariaCategory;
tortoise.categoryBitMask = TortoiseCategory;
bullet.categoryBitMask = BulletCategory;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>然后分别给maria，tortoise以及bullte的categoryBitMask设置为相应值。同时我们需要在以下情形中判断contact发生并作出相应，如马里奥碰到乌龟，马里奥die;子弹碰到乌龟，乌龟die:</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">maria</span><span class="p">.</span><span class="n">contactTestBitMask</span> <span class="o">=</span> <span class="n">TortoiseCategory</span><span class="p">;</span>
<span class="n">tortoise</span><span class="p">.</span><span class="n">contactTestBitMask</span> <span class="o">=</span> <span class="n">BulletCategory</span> <span class="o">|</span> <span class="n">MariaCategory</span><span class="p">;</span>
<span class="n">bullet</span><span class="p">.</span><span class="n">contactTestBitMask</span> <span class="o">=</span> <span class="n">TortoiseCategory</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>上面将maria感兴趣的contact ID集设置为乌龟，乌龟设置为子弹和马里奥，子弹设置为乌龟。用32位非常便于取或操作，同时也限定了一个游戏场景里的碰撞接触的身份证只能有32个。</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">@interface</span> <span class="nc">GameScene</span> <span class="p">:</span> <span class="nc">SKScene</span> <span class="o">&lt;</span><span class="n">SKPhysicsContactDelegate</span><span class="o">&gt;</span>
<span class="k">@end</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">moveToParent</span><span class="o">:</span><span class="p">(</span><span class="n">SKNode</span> <span class="o">*</span> <span class="p">)</span><span class="n">parent</span><span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">physicsWorld</span><span class="p">.</span><span class="n">contactDelegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didBeginContact</span><span class="o">:</span><span class="p">(</span><span class="n">SKPhysicsContact</span> <span class="o">*</span> <span class="p">)</span><span class="n">contact</span><span class="p">{</span>
    <span class="c1">//我们来简单举一个子弹打到乌龟，乌龟die的contact测试。
</span>    <span class="n">SKPhysicsBody</span> <span class="o">*</span> <span class="n">tortoise</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">bodyA</span><span class="p">.</span><span class="n">categoryBitMask</span> <span class="o">==</span> <span class="n">BulletCategory</span> <span class="o">&amp;&amp;</span>
        <span class="n">contact</span><span class="p">.</span><span class="n">bodyB</span><span class="p">.</span><span class="n">categoryBitMask</span> <span class="o">==</span> <span class="n">TortoiseCategory</span><span class="p">){</span>
        <span class="n">tortoise</span> <span class="o">=</span> <span class="n">contact</span><span class="p">.</span><span class="n">bodyB</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">bodyB</span><span class="p">.</span><span class="n">categoryBitMask</span> <span class="o">==</span> <span class="n">BulletCategory</span> <span class="o">&amp;&amp;</span>
        <span class="n">contact</span><span class="p">.</span><span class="n">bodyA</span><span class="p">.</span><span class="n">categoryBitMask</span> <span class="o">==</span> <span class="n">TortoiseCategory</span><span class="p">){</span>
        <span class="n">tortoise</span> <span class="o">=</span> <span class="n">contact</span><span class="p">.</span><span class="n">bodyA</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"tortoise die: %@"</span><span class="p">,</span> <span class="n">tortoise</span><span class="p">);</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这样当子弹打到乌龟，GameScene 作为SKPhysicsContactDelegate就会响应-didBeginContact: 方法，然后判断情形，如果是，则打印出来”tortoise die:tortoise的object信息”。</p>

<p>了解了categoryBitMask 和contactTestBitMask， 我们再来看collisionBitMask就简单了，它表示物体之间会不会intersect，也是32位数。默认是32个1，表示与任何物体碰撞都不会穿过那个物体。如果你需要将某个物体穿过另一个物体，比如子弹打到马里奥，直接穿过(当然游戏中不可能发生):</p>

<figure class="highlight"><pre><code class="language-objec" data-lang="objec"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>maria.collisionBitMask = ~BulletCategory;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>最后力的施加我们在SKAction里介绍。</p>

<h3 id="skaction">2.3. SKAction</h3>
<p>SKAction表示一个动作，由SKNode得 -runAction: 方法执行，它有几十个方法。下面列出几个比较典型的， 它的实例化大部分都是类工厂方法:</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre>SKAction Class

初始化方法:
+moveByX:y:duration:                    // 移动一个SKNode;
+rotationByAngule:duration:             // 转动一个SKNode;
+hide                                   // 隐藏一个SKNode， 对应的还有 +unhide;
+applyForce:duration:                   // 施加力;
+playSoundFileNamed:waitForCompletion:  // 播放音频文件;
+removeFromParent                       // 将SKNode从父node里移除;
+waitForDuration:                       // 等待的动作，在SKAction group和sequence里用到;

+group:                                 // 组合几个SKAction，从时间起点，这几个SKAction同时开始;
+sequence:                              // 串联几个SKAction，从时间起始点，下一个的开始在上一个结束后才执行;
+repeatActionForever:                   // 永远重复SKAction;
-reversedAction:                        // 逆向一个SKAction，如原来从左到右2秒，现在从右到左两秒;

+runBlock:queque:                       // 在队列里执行SKAction;
+customActionWithDuration:actionBlock:  // 定制SKAction;<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>例如马里奥中需要一个空中台阶，“”从左到右2秒，等待0.5秒，从右到左2秒，等待0.5秒 ”的sequence永远运行下去，code如下:</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="n">SKAction</span> <span class="o">*</span> <span class="n">moveToRight</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKAction</span> <span class="nf">moveByX</span><span class="p">:</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">-</span><span class="n">self</span><span class="p">.</span><span class="n">platform</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="nf">y</span><span class="p">:</span> <span class="mi">0</span> <span class="n">duration</span><span class="o">:</span><span class="mi">2</span><span class="p">];</span>
<span class="n">SKAction</span> <span class="o">*</span> <span class="n">moveToLeft</span> <span class="o">=</span> <span class="p">[</span><span class="n">moveToRight</span> <span class="nf">reversedAction</span><span class="p">];</span>
<span class="n">SKAction</span> <span class="o">*</span> <span class="n">wait</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKAction</span> <span class="nf">waitForDuration</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">];</span>
<span class="n">SKAction</span> <span class="o">*</span> <span class="n">moveToRightAndLeft</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKAction</span> <span class="nf">sequence</span><span class="p">:@[</span><span class="n">moveToRight</span><span class="err">，</span><span class="n">wait</span><span class="err">，</span><span class="n">moveToLeft</span><span class="err">，</span><span class="n">wait</span><span class="p">]];</span>
<span class="n">SKAction</span> <span class="o">*</span> <span class="n">moveToRightAndLeftForever</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKAction</span> <span class="nf">repeatActionForever</span><span class="p">:</span><span class="n">moveToRightAndLeft</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">platform</span> <span class="nf">runAction</span><span class="p">:</span><span class="n">moveToRightAndLeftForever</span><span class="p">];</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="section">3.其它类</h2>
<p>在SKView中，场景的不同切换要用到SKTransition，self指一个scene:</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">SKTransition</span> <span class="o">*</span> <span class="n">doorOpenTransition</span> <span class="o">=</span> <span class="p">[</span><span class="n">SKTransition</span> <span class="nf">doorsOpenHorizontalWithDuration</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nf">presentScene</span><span class="p">:</span><span class="n">winScene</span> <span class="nf">transition</span><span class="p">:</span><span class="n">doorOpenTransition</span><span class="p">];</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="section-1">4 总结</h2>
<p>以上对于SKSpriteKit里的大部分常用类及其用法做了介绍，相信读者能够自己画出SKSpriteKit的类图关系，再回过头来跟着online的SKSpriteKit的tutorial做一遍的时候，自然就了然于心。后面还有一篇从各个小topic来看SKSpriteKit。</p>

            <div class="clearfix"></div>
        </div>


    
    <ul class="tag_box list-unstyled list-inline">
      <li><i class="fa fa-folder-open"></i></li>
      
      
      
        <li><a href="http://www.shunmian.me/categories.html#Objective-C-ref">
          Objective-C <span>(10)</span>
          
        </a></li>
      
      
    </ul>
    

    
    <ul class="list-inline">
      <li><i class="fa fa-tags"></i></li>
      
      
      
        <li>
          <a href="http://www.shunmian.me/tags.html#SpriteKit-ref">
          SpriteKit <span>(1)</span>
          
          </a>
        </li>
      
      
      
    </ul>
    

<hr />
<div >
    <section class="col-sm-7">
        <h4>Share Post</h4>
        <a class="btn btn-default btn-sm" href="http://twitter.com/share?text=iOS 2D Game - SpriteKit入门(一)&via=Wanderl29817400" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fa fa-twitter fa-sm"></i>
        Twitter
        </a>

        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-sm"></i>
          Facebook
        </a>

        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-sm"></i>
          Google+
        </a>
    </section>

    <section class="col-sm-5">
        <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df" class="img-rounded" />
        <h4>Shunmian</h4>
        <p class="author-bio">节物风光不相待，桑田碧海须臾改，唯有美食和code不可辜负。</p>

    </section>

</div>
<div class="clearfix"></div>

<ul class="pager">
    
    <li class="previous"><a href="http://www.shunmian.me/objective-c/2016/02/18/Key-Value-Observing.html" title= "">&larr; Previous</a></li>
    
    
    <li class="next">"<a href="http://www.shunmian.me/swift/2016/03/07/Guard%E5%85%B3%E9%94%AE%E8%AF%8D.html" title= "guard 关键字">Next &rarr;</a></li>
    
</ul>

    <hr />
    
    <section class="comments" style="margin-top:15px;">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shunmianjohnson'; // required: replace example with your forum shortname
        if(disqus_shortname){
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        }
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
    
    </div>
    <div class="col-sm-1sidebar-2"></div>
    <div class="clearfix"></div>
</article>
<div class="clearfix"></div>


                <div class="footer">
                    <footer>
                        <hr />
                        <p> &copy: 2015 Shunmian with jekyll. Theme: <a href="https://github.com/dbtek/dbyll"dbyll</a> by dbtek.
                        </p>
                    </footer>
                </div>
            </div>
        </div>
    </div>


    <script src="/assets/js/jquery-2.2.0.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/script.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
    <script type="text/javascript">

$youziku.load(".sidebar_bio", "bdcc72b8235345649b02c123dac5610b", "SiYuan-ExtraLight");


   $youziku.draw();
</script>

</body>

</html>

