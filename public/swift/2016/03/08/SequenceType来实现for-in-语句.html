<!DOCTYPE html>
<html lang = "en">
<head>
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/posts/favico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/posts/favico/favico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/posts/favico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/posts/favico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/posts/favico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/posts/favico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/posts/favico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/posts/favico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/posts/favico/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/posts/favico/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/posts/favico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/posts/favico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/posts/favico/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/posts/favico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/images/posts/favico/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">   

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/font-awesome/css/font-awesome.min.css">
    <link href="/assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>
<!--     <script type="text/javascript" src="http://api.youziku.com/webfont/FastJS/yzk_976E121ED7CC0870"></script> -->

    <title>SHUNMIAN</title>
</head>


<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 sidebar hidden-xs sidebar">
                
<!--sidebar.html-->
        <header class="sidebar_header " role="banner">
            <a href="http://www.shunmian.me/index.html">
                <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df?s=150" class="img-circle img-responsive center-block sidebar_logo sidebar_img" />
            </a>


            <h3 class="title text-center">
                <a href="http://www.shunmian.me/index.html">SHUNMIAN</a>
            </h3>

        </header>


        <hr class="hr_short"/>
        <div id = "bio" class="text-center sidebar_bio">
            

                <p>嗨，欢迎来到我的博客。<br/>
                我是Shunmian，一名iOS开发者。<br/>
                <hr class = "hr_short_low">
                正在学习Algorithm，Functional Programming，Machine Learning，Data Mining 和 Cloud Computation。 

                </p>

            
        </div>


        <hr class="hr_middle"/>
        <div id = "contact-list" class="text-center">
            <ul class="list-unstyled list-inline">
                <li>
                    
                    <a class="btn btn_info_outline" href="mailto:shunmian@gmail.com"><i class="fa fa-envelope fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-github fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-twitter fa-lg"></i></a>
                    
                </li>

                <li>
                    <a class="btn btn_info_outline" href="http://www.shunmian.me/feed.xml"><i class="fa fa-rss fa-lg"></i></a>
                </li>
        </div>


        <hr class="hr_short"/>
        <div id = "contact-list" class="text-center">
            <ul class="unstyled-list list-inline">
                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/index.html"><i class="fa fa-home fa-md"></i> 主页</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/tags.html"><i class="fa fa-tags fa-md"></i> 标签</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/categories.html"><i class="fa fa-list fa-md"></i> 分类</a>
                </li>
            </ul>
        </div>
        <div class="padding_bottom_500"></div>




<!--sidebar.html end-->

            </div>

            <div class="col-sm-9 col-sm-offset-3">
                

<div class="page-header col-sm-10 col-sm-offset-1">
    <h1 class="article_mainTitle">CollectionType = SequenceType(AnyGenerator：GeneratorType) + Indexable </h1>
    <span class="post_date">
        2016-03-08 •
    </span>
    <span class="post_category">
        Swift
    </span>
</div>

<article class="article">
    <div class="col-sm-10 col-sm-offset-1">
        <div class="article_mainBody">
            <p class="article_content_title">目录</p>

<ul id="markdown-toc">
  <li><a href="#collectiontype-protocol" id="markdown-toc-collectiontype-protocol">1. CollectionType protocol</a></li>
  <li><a href="#sequencetype-protocol" id="markdown-toc-sequencetype-protocol">2. SequenceType protocol</a>    <ul>
      <li><a href="#sequencetype-forin" id="markdown-toc-sequencetype-forin">2.1 SequenceType 实现for…in遍历</a>        <ul>
          <li><a href="#generatortype-protocol-" id="markdown-toc-generatortype-protocol-">2.1.1 GeneratorType protocol 正向遍历</a></li>
          <li><a href="#generatortype-protocol--1" id="markdown-toc-generatortype-protocol--1">2.1.2 GeneratorType protocol 反向遍历</a></li>
          <li><a href="#anygenerator-generatortype" id="markdown-toc-anygenerator-generatortype">2.1.3 AnyGenerator: GeneratorType</a></li>
        </ul>
      </li>
      <li><a href="#sequencetype-map-filter-reduce" id="markdown-toc-sequencetype-map-filter-reduce">2.2 SequenceType: map, filter, reduce</a></li>
    </ul>
  </li>
  <li><a href="#indexable-" id="markdown-toc-indexable-">3 Indexable 实现下标索引</a></li>
  <li><a href="#section" id="markdown-toc-section">4 总结</a></li>
</ul>

<hr class="hr-short-left" />

<h2 id="collectiontype-protocol">1. CollectionType protocol</h2>
<p>工欲善其事必先利其器。对于面向对象编程来说，面向接口编程优于面向继承编程(Swift和Objective-C一样都是单继承)。接口在Swift就是protocol. Swift从一开始就是一门protocol oriented programming language, 其强大的protocol功能(包括泛型, extension的默认实现，associated type等)给其其他语言无法比拟的灵活性和全面性。Swift内建了70多个公共接口，这些每个接口就像梯子的每个台阶一样，从各个角度来定义某种接口需要的属性和方法，同时在一个又一个的完美的台阶上，搭建出了例如Array, NSDictionary等功能丰富的内置类。理解Swift内置接口对于实现我们自己的类起着事半功倍的效果—我们要解决的问题，swift工程师可能已经有成熟的解决方案了。让我们借着用CollectionType这个protocol实现”for…in”快速枚举和下标索引取值这两个功能来看看swift的内置协议。</p>

<p>我对<code class="highlighter-rouge">CollectionType</code>的定义:</p>

<blockquote>
  <p><b>ColletionType(集合类)</b>: 即可快速遍历又可下标索引的类。解释: 继承自<code class="highlighter-rouge">SequenceType</code>和<code class="highlighter-rouge">Indexable</code>。</p>
</blockquote>

<p>有很多Swift内置类实现了<code class="highlighter-rouge">CollectionType</code>,如Array, Dictionary, Set等。下面我们将分别看看<code class="highlighter-rouge">SequenceType</code>和<code class="highlighter-rouge">Indexable</code>这两个协议</p>

<h2 id="sequencetype-protocol">2. SequenceType protocol</h2>

<p>我对SequenceType的定义</p>

<blockquote>
  <p><b>SequenceType(序列类)</b>：可以用for…in进行快捷遍历。 解释: 其本质是对<code class="highlighter-rouge">GeneratorType</code>进行包装, 有一个产生GeneratorType的工厂方法<code class="highlighter-rouge">generate() -&gt; Generator</code>, <code class="highlighter-rouge">Generator</code>在其关联类别名中定义。</p>
</blockquote>

<p>下面是SequenceType 在Swift 文档中的定义，供参考：</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>SequenceType protocol：A Type that can be iterated with a for...in loop。

typealias Generator: GeneratorType // a type that provides the sequence's iteration interface and encapsutlates its iteration state.

func generate() -&gt;Self.Generator //required, return a generator over the elements of this sequence.<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>我对GeneratorType的定义</p>

<blockquote>
  <p><b>GeneratorType(生成器)</b>：一个生成一个序列的机器，解决下一个生成”哪个”“类”的实例的问题。解释: 生成器犹如一个自动乒乓机, 你告诉他弹出什么(关联类别名Element),以及弹出哪个<code class="highlighter-rouge">(next() -&gt;Element?</code>（可以正向或者反向弹出，或者弹出Int序列，作为Array的下标)。每次调用<code class="highlighter-rouge">next()</code>，就像按一个开关，自动乒乓机就弹出乒乓球(或者其他类)或者nil。但是<code class="highlighter-rouge">GeneratorType</code>实例没有重置方法。换言之，出来的乒乓球不可逆，如果要重新开始，就要再实例化一个<code class="highlighter-rouge">GeneratorType</code>。而<code class="highlighter-rouge">SequnceType</code>的<code class="highlighter-rouge">generator()</code>方法就是<code class="highlighter-rouge">GeneratorType</code>的工厂方法， 它的for…in语法就是对<code class="highlighter-rouge">generator()</code>和<code class="highlighter-rouge">next()</code>的调用的封装。因此SequenceType可以有multi-pass, 每次用for…in快速遍历，就实例化一个<code class="highlighter-rouge">GeneratorType</code>。</p>
</blockquote>

<p>下面是GeneratorType在Swift文档中的定义供参考</p>

<figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>GeneratorType protocol: Encapsulates iteration state and interface for interation over a sequence.

typealias Element //the type of element generated by self

mutating func next() -&gt;Self.Element //required, advance to the next element and return it, or nil if no next element exists.<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>下面我们举一个简单的例子来实现我们一个BookList的for…in 功能。</p>

<h3 id="sequencetype-forin">2.1 SequenceType 实现for…in遍历</h3>
<p>问题： 我们有一个自定义的类BookList，里面放着Book类，实现BookList的for…in枚举方法，可以正向遍历或者反向遍历。</p>

<h4 id="generatortype-protocol-">2.1.1 GeneratorType protocol 正向遍历</h4>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></td><td class="code"><pre><span class="c1">//  这是Book类，作为BookList的元素</span>
<span class="kd">class</span> <span class="kt">Book</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">name</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">var</span> <span class="nv">price</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span><span class="kt">String</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="kt">Double</span><span class="p">){</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*  BookListGenerator类，初始化时用一个[Book]?可选数组。
    关联类别名是Book； 方法next()返回Book或者nil。*/</span>
<span class="kd">class</span> <span class="kt">BookListGenerator</span><span class="p">:</span> <span class="kt">GeneratorType</span><span class="p">{</span>
    <span class="k">var</span> <span class="nv">bookList</span><span class="p">:[</span><span class="kt">Book</span><span class="p">]?</span>
    <span class="k">var</span> <span class="nv">currentIndex</span><span class="p">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">bookList</span><span class="p">:[</span><span class="kt">Book</span><span class="p">]?){</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bookList</span> <span class="o">=</span> <span class="n">bookList</span>
    <span class="p">}</span>
    
    <span class="kd">typealias</span> <span class="kt">Element</span> <span class="o">=</span> <span class="kt">Book</span>
    <span class="kd">func</span> <span class="nf">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Element</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">list</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span> <span class="k">else</span><span class="p">{</span><span class="k">return</span> <span class="kc">nil</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span><span class="p">{</span>
            <span class="k">let</span> <span class="nv">element</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">]</span>
            <span class="n">currentIndex</span><span class="o">++</span>
            <span class="k">return</span> <span class="n">element</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*  BookList类，初始化为一[Book]空数组。
    关联类别名是BookListGenerator, 方法generate返回BookListGenerator。*/</span>
<span class="kd">class</span> <span class="kt">BookList</span><span class="p">{</span>
    <span class="k">var</span> <span class="nv">bookList</span><span class="p">:[</span><span class="kt">Book</span><span class="p">]?</span>
    
    <span class="nf">init</span><span class="p">(){</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bookList</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Book</span><span class="p">]()</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">addBook</span><span class="p">(</span><span class="nv">book</span><span class="p">:</span> <span class="kt">Book</span><span class="p">){</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bookList</span><span class="p">?</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">removeBookAtIndex</span><span class="p">(</span><span class="nv">index</span><span class="p">:</span> <span class="kt">Int</span><span class="p">){</span>
        <span class="k">self</span><span class="o">.</span><span class="n">bookList</span><span class="p">?</span><span class="o">.</span><span class="nf">removeAtIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">BookList</span><span class="p">:</span> <span class="kt">SequenceType</span><span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Generator</span> <span class="o">=</span> <span class="kt">BookListGenerator</span>
    <span class="kd">func</span> <span class="nf">generate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Generator</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">BookListGenerator</span><span class="p">(</span><span class="nv">bookList</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>我们来试一下for…in枚举方法</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="k">var</span> <span class="nv">book1</span> <span class="o">=</span> <span class="kt">Book</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"c"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">book2</span> <span class="o">=</span> <span class="kt">Book</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"iOS"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="mf">18.0</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">book3</span> <span class="o">=</span> <span class="kt">Book</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Swift"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="mf">24.0</span><span class="p">)</span>

<span class="k">var</span> <span class="nv">customizedBookList</span> <span class="o">=</span> <span class="kt">BookList</span><span class="p">()</span>
<span class="n">customizedBookList</span><span class="o">.</span><span class="nf">addBook</span><span class="p">(</span><span class="n">book1</span><span class="p">)</span>
<span class="n">customizedBookList</span><span class="o">.</span><span class="nf">addBook</span><span class="p">(</span><span class="n">book2</span><span class="p">)</span>
<span class="n">customizedBookList</span><span class="o">.</span><span class="nf">addBook</span><span class="p">(</span><span class="n">book3</span><span class="p">)</span>


<span class="k">for</span> <span class="n">book</span> <span class="k">in</span> <span class="n">customizedBookList</span><span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Book-------name: </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">; price </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">price</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="cm">/*  输出为：
    Book-------name: c; price 12.0
    Book-------name: iOS; price 18.0
    Book-------name: Swift; price 24.0
*/</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="generatortype-protocol--1">2.1.2 GeneratorType protocol 反向遍历</h4>
<p>实现了正向遍历，反向遍历就很简单了，代码如下</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kd">class</span> <span class="kt">BookListGenerator</span><span class="p">:</span> <span class="kt">GeneratorType</span><span class="p">{</span>
<span class="o">...</span>
    <span class="kd">typealias</span> <span class="kt">Element</span> <span class="o">=</span> <span class="kt">Book</span>
    <span class="kd">func</span> <span class="nf">next</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Element</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">list</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span> <span class="k">else</span><span class="p">{</span><span class="k">return</span> <span class="kc">nil</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span><span class="p">{</span>
            <span class="k">let</span> <span class="nv">element</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">list</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">currentIndex</span><span class="o">++</span>
            <span class="k">return</span> <span class="n">element</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="o">...</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>同样的例子，输出如下:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="k">for</span> <span class="n">book</span> <span class="k">in</span> <span class="n">customizedBookList</span><span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Book-------name: </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">; price </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">price</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="cm">/*  输出为：
    Book-------name: Swift; price 24.0
    Book-------name: iOS; price 18.0
    Book-------name: c; price 12.0
*/</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="anygenerator-generatortype">2.1.3 AnyGenerator: GeneratorType</h4>
<p>如果每次实现定制类的for…in遍历都需要自己实现GeneratorType的类很不方便，Swift提供了一内置的生成器AnyGenerator。
我对AnyGenerator的定义如下:</p>

<blockquote>
  <p><b>AnyGenerator(任何生成器)</b>: 用一个全局函数尾随闭包来解决下一个生成”哪个”“类”的实例的问题的内置生成器。解释:
生成AnyGenerator的方法是, func anyGenerator<Element>(body: () -&gt; Element?) -&gt; AnyGenerator<Element>
    是一个全局函数，输入是() -&gt; Element?类型的函数，与next()作用一样，输出是AnyGenerator<Element>。</Element></Element></Element></p>
</blockquote>

<p>我们来看看如何改写2.1</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="o">...</span>
<span class="kd">extension</span> <span class="kt">BookList</span><span class="p">:</span> <span class="kt">SequenceType</span><span class="p">{</span>
    <span class="kd">typealias</span> <span class="kt">Generator</span> <span class="o">=</span> <span class="kt">AnyGenerator</span><span class="o">&lt;</span><span class="kt">Book</span><span class="o">&gt;</span>
    <span class="kd">func</span> <span class="nf">generate</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Generator</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nf">anyGenerator</span><span class="p">(){</span> <span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span> <span class="o">&lt;</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span><span class="p">?</span><span class="o">.</span><span class="n">count</span> <span class="p">?</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span><span class="o">!</span><span class="p">[</span><span class="k">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="o">++</span><span class="p">]</span> <span class="p">:</span> <span class="kc">nil</span><span class="p">}</span>
    <span class="p">}</span>
<span class="cm">/*  func anyGenerator&lt;Element&gt;(body: () -&gt; Element?) -&gt; AnyGenerator&lt;Element&gt;
    是一个全局函数，输入是() -&gt; Element?类型的函数，与next()作用一样，输出是AnyGenerator&lt;Element&gt;*/</span>
<span class="p">}</span>
<span class="o">...</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这样我们就不需要自己建一个新的Generator的子类了，非常方便。</p>

<h3 id="sequencetype-map-filter-reduce">2.2 SequenceType: map, filter, reduce</h3>
<p>SequenceType 默认实现了很多高阶函数，例如map, filter, reduce等，因此实现SequenceType的类就可以用这些函数，举例如下:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre><span class="c1">//map 函数计算每本书的进价，返回数组</span>
<span class="k">var</span> <span class="nv">boughtPrice</span> <span class="o">=</span> <span class="n">customizedBookList</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="k">return</span> <span class="nv">$0</span><span class="o">.</span><span class="n">price</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">boughtPrice</span><span class="p">)</span>
<span class="cm">/*  输出为：
    [9.6, 14.4, 19.2]
*/</span>

<span class="c1">//filter函数返回价格&lt;20的Book数组</span>
<span class="k">var</span> <span class="nv">lowPriceBooks</span> <span class="o">=</span> <span class="n">customizedBookList</span><span class="o">.</span><span class="n">filter</span><span class="p">{</span><span class="nv">$0</span><span class="o">.</span><span class="n">price</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">}</span>
<span class="k">for</span> <span class="n">book</span> <span class="k">in</span> <span class="n">lowPriceBooks</span><span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Book-------name: </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">; price </span><span class="se">\(</span><span class="n">book</span><span class="o">.</span><span class="n">price</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="cm">/*  输出为：
    Book-------name: c; price 12.0
    Book-------name: iOS; price 18.0
*/</span>

<span class="cm">/*reduce函数返回价格最高的Book,这里初始值应该是customizedBookList[0],
由于其还没有实现Indexable接口，因此不能用下标取其元素，我们用book1替代*/</span>
<span class="k">var</span> <span class="nv">highestPriceBook</span><span class="p">:</span> <span class="kt">Book</span> <span class="o">=</span> <span class="n">customizedBookList</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="n">book1</span><span class="p">){</span>
    <span class="nv">$0</span><span class="o">.</span><span class="n">price</span> <span class="o">&gt;</span> <span class="nv">$1</span><span class="o">.</span><span class="n">price</span> <span class="p">?</span> <span class="nv">$0</span><span class="p">:</span> <span class="nv">$1</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"Highest Price Book-------name: </span><span class="se">\(</span><span class="n">highestPriceBook</span><span class="o">.</span><span class="n">name</span><span class="se">)</span><span class="s">; price </span><span class="se">\(</span><span class="n">highestPriceBook</span><span class="o">.</span><span class="n">price</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="cm">/*  输出为：
    Highest Price Book-------name: Swift; price 24.0
*/</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="indexable-">3 Indexable 实现下标索引</h2>

<p>我对其定义如下</p>

<blockquote>
  <p><b>Indexable(可索引)</b>: 定义了下标取值的接口。解释: 两个属性一个方法，<code class="highlighter-rouge">startIndex</code>是索引起点，<code class="highlighter-rouge">endIndex</code>是索引终点+1; <code class="highlighter-rouge">subscript(position: Int) -&gt;Book</code>定义了下标方法。</p>
</blockquote>

<p>code见下</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kd">extension</span> <span class="kt">BookList</span><span class="p">:</span> <span class="kt">Indexable</span><span class="p">{</span>
    <span class="k">var</span> <span class="nv">startIndex</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="k">var</span> <span class="nv">endIndex</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">list</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span> <span class="k">else</span><span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">.</span><span class="n">count</span>
    <span class="p">}</span>
    
    <span class="nf">subscript</span><span class="p">(</span><span class="nv">position</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span><span class="kt">Book</span><span class="p">?{</span>
        <span class="nf">return</span> <span class="p">(</span><span class="n">startIndex</span> <span class="o">..&lt;</span> <span class="n">endIndex</span><span class="p">)</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="p">?</span> <span class="k">self</span><span class="o">.</span><span class="n">bookList</span><span class="p">?[</span><span class="n">position</span><span class="p">]:</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="k">var</span> <span class="nv">book1</span> <span class="o">=</span> <span class="kt">Book</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"c"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">book2</span> <span class="o">=</span> <span class="kt">Book</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"iOS"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="mf">18.0</span><span class="p">)</span>
<span class="k">var</span> <span class="nv">book3</span> <span class="o">=</span> <span class="kt">Book</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"Swift"</span><span class="p">,</span> <span class="nv">price</span><span class="p">:</span> <span class="mf">24.0</span><span class="p">)</span>

<span class="k">var</span> <span class="nv">customizedBookList</span> <span class="o">=</span> <span class="kt">BookList</span><span class="p">()</span>
<span class="n">customizedBookList</span><span class="o">.</span><span class="nf">addBook</span><span class="p">(</span><span class="n">book1</span><span class="p">)</span>
<span class="n">customizedBookList</span><span class="o">.</span><span class="nf">addBook</span><span class="p">(</span><span class="n">book2</span><span class="p">)</span>
<span class="n">customizedBookList</span><span class="o">.</span><span class="nf">addBook</span><span class="p">(</span><span class="n">book3</span><span class="p">)</span>


<span class="nf">print</span><span class="p">(</span><span class="n">bookList</span><span class="o">.</span><span class="n">endIndex</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">bookList</span><span class="o">.</span><span class="n">startIndex</span><span class="p">)</span>
<span class="k">for</span><span class="p">(</span><span class="k">var</span> <span class="nv">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">customizedBookList</span><span class="o">.</span><span class="n">endIndex</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">customizedBookList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!.</span><span class="n">name</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="cm">/*  输出:
    3
    0
    c
    iOS
    Swift
*/</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="section">4 总结</h2>
<p><code class="highlighter-rouge">SequenceType</code>是序列类，生成了for…in的便捷遍历方法。其为生成器类的包装，有一个生成器类的工厂方法。 生成器类解决了下一个生成”哪个”“类”的实例的问题。<code class="highlighter-rouge">SequenceType</code>可以生成自定义继承自<code class="highlighter-rouge">GeneratorType</code>的类，也可以用<code class="highlighter-rouge">anyGnerator()</code>的Swift全局方法定义一个<code class="highlighter-rouge">AnyGenerator</code>类(方便于不用每次自定义)。<code class="highlighter-rouge">GeneratorType</code>里的<code class="highlighter-rouge">next()</code>方法让我们自定义如何取下一个实例(如正向，反向，Range<Int>作为array下标，无穷Range等)。同时实现了`SequenceType`接口的类可以享用其默认实现了的高阶函数, 如`map`，`filter`，`reduce`等。</Int></p>

<p><code class="highlighter-rouge">Indexable</code>定义了下标取值的接口。<code class="highlighter-rouge">startIndex</code>是索引起点，<code class="highlighter-rouge">endIndex</code>是索引终点+1; <code class="highlighter-rouge">subscript(position: Int) -&gt;Book</code>定义了下标方法。</p>

<p><code class="highlighter-rouge">SequenceType</code> + <code class="highlighter-rouge">Indexable</code> = <code class="highlighter-rouge">CollectionType</code>。有很多Swift内置类实现了<code class="highlighter-rouge">CollectionType</code>,如Array, Dictionary, Set等</p>


            <div class="clearfix"></div>
        </div>


    
    <ul class="tag_box list-unstyled list-inline">
      <li><i class="fa fa-folder-open"></i></li>
      
      
      
        <li><a href="http://www.shunmian.me/categories.html#Swift-ref">
          Swift <span>(5)</span>
          
        </a></li>
      
      
    </ul>
    

    
    <ul class="list-inline">
      <li><i class="fa fa-tags"></i></li>
      
      
      
        <li>
          <a href="http://www.shunmian.me/tags.html#protocol-ref">
          protocol <span>(1)</span>
          
          </a>
        </li>
      
      
      
    </ul>
    

<hr />
<div >
    <section class="col-sm-7">
        <h4>Share Post</h4>
        <a class="btn btn-default btn-sm" href="http://twitter.com/share?text=CollectionType = SequenceType(AnyGenerator：GeneratorType) + Indexable&via=Wanderl29817400" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fa fa-twitter fa-sm"></i>
        Twitter
        </a>

        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-sm"></i>
          Facebook
        </a>

        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-sm"></i>
          Google+
        </a>
    </section>

    <section class="col-sm-5">
        <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df" class="img-rounded" />
        <h4>Shunmian</h4>
        <p class="author-bio">节物风光不相待，桑田碧海须臾改，唯有美食和code不可辜负。</p>

    </section>

</div>
<div class="clearfix"></div>

<ul class="pager">
    
    <li class="previous"><a href="http://www.shunmian.me/swift/2016/03/07/weak-strong-dance.html" title= "">&larr; Previous</a></li>
    
    
    <li class="next">"<a href="http://www.shunmian.me/swift/2016/03/09/Let's-build-Array.html" title= "Let's Build Swift.Array">Next &rarr;</a></li>
    
</ul>

    <hr />
    
    <section class="comments" style="margin-top:15px;">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shunmianjohnson'; // required: replace example with your forum shortname
        if(disqus_shortname){
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        }
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
    
    </div>
    <div class="col-sm-1sidebar-2"></div>
    <div class="clearfix"></div>
</article>
<div class="clearfix"></div>


                <div class="footer">
                    <footer>
                        <hr />
                        <p> &copy: 2015 Shunmian with jekyll. Theme: <a href="https://github.com/dbtek/dbyll"dbyll</a> by dbtek.
                        </p>
                    </footer>
                </div>
            </div>
        </div>
    </div>


    <script src="/assets/js/jquery-2.2.0.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/script.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
    <script type="text/javascript">

$youziku.load(".sidebar_bio", "bdcc72b8235345649b02c123dac5610b", "SiYuan-ExtraLight");


   $youziku.draw();
</script>

</body>

</html>

