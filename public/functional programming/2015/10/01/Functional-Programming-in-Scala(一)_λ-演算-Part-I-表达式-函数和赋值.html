<!DOCTYPE html>
<html lang = "en">
<head>
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/posts/favico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/posts/favico/favico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/posts/favico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/posts/favico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/posts/favico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/posts/favico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/posts/favico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/posts/favico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/posts/favico/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/posts/favico/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/posts/favico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/posts/favico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/posts/favico/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/posts/favico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/images/posts/favico/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">   

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/font-awesome/css/font-awesome.min.css">
    <link href="/assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>
<!--     <script type="text/javascript" src="http://api.youziku.com/webfont/FastJS/yzk_976E121ED7CC0870"></script> -->

    <title>SHUNMIAN</title>
</head>


<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 sidebar hidden-xs sidebar">
                
<!--sidebar.html-->
        <header class="sidebar_header " role="banner">
            <a href="http://www.shunmian.me/index.html">
                <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df?s=150" class="img-circle img-responsive center-block sidebar_logo sidebar_img" />
            </a>


            <h3 class="title text-center">
                <a href="http://www.shunmian.me/index.html">SHUNMIAN</a>
            </h3>

        </header>


        <hr class="hr_short"/>
        <div id = "bio" class="text-center sidebar_bio">
            

                <p>嗨，欢迎来到我的博客。<br/>
                我是Shunmian，一名iOS开发者。<br/>
                <hr class = "hr_short_low">
                正在学习Algorithm，Functional Programming，Machine Learning，Data Mining 和 Cloud Computation。 

                </p>

            
        </div>


        <hr class="hr_middle"/>
        <div id = "contact-list" class="text-center">
            <ul class="list-unstyled list-inline">
                <li>
                    
                    <a class="btn btn_info_outline" href="mailto:shunmian@gmail.com"><i class="fa fa-envelope fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-github fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-twitter fa-lg"></i></a>
                    
                </li>

                <li>
                    <a class="btn btn_info_outline" href="http://www.shunmian.me/feed.xml"><i class="fa fa-rss fa-lg"></i></a>
                </li>
        </div>


        <hr class="hr_short"/>
        <div id = "contact-list" class="text-center">
            <ul class="unstyled-list list-inline">
                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/index.html"><i class="fa fa-home fa-md"></i> 主页</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/tags.html"><i class="fa fa-tags fa-md"></i> 标签</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/categories.html"><i class="fa fa-list fa-md"></i> 分类</a>
                </li>
            </ul>
        </div>
        <div class="padding_bottom_500"></div>




<!--sidebar.html end-->

            </div>

            <div class="col-sm-9 col-sm-offset-3">
                

<div class="page-header col-sm-10 col-sm-offset-1">
    <h1 class="article_mainTitle">FP in Scala(一)：λ-演算 Part I：表达式，函数和赋值 </h1>
    <span class="post_date">
        2015-10-01 •
    </span>
    <span class="post_category">
        Functional Programming
    </span>
</div>

<article class="article">
    <div class="col-sm-10 col-sm-offset-1">
        <div class="article_mainBody">
            <p class="article_content_title">目录</p>

<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1. 什么是函数式编程</a></li>
  <li><a href="#calculus" id="markdown-toc-calculus">2 函数式编程的理论基础：λ-Calculus</a>    <ul>
      <li><a href="#expression" id="markdown-toc-expression">2.1 表达式(Expression)</a></li>
      <li><a href="#function--block" id="markdown-toc-function--block">2.2 函数(Function) 和 Block(匿名函数)</a></li>
      <li><a href="#application" id="markdown-toc-application">2.3 赋值(Application)</a></li>
      <li><a href="#conditonals" id="markdown-toc-conditonals">2.4 Conditonals</a></li>
      <li><a href="#tail-recursion" id="markdown-toc-tail-recursion">2.5 Tail Recursion</a></li>
    </ul>
  </li>
  <li><a href="#assignment" id="markdown-toc-assignment">3 Assignment</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">4 总结</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">5 参考资料</a></li>
</ul>

<hr class="hr-short-left" />

<h2 id="section">1. 什么是函数式编程</h2>

<p class="img_middle_lg"><img src="/assets/images/posts/2015-10-01/Programming Paradigm.png" alt="Programming Paradigm" /></p>

<p>编程范式的发展有两个正交的方向，一个是从<strong>数据和函数的封装</strong>的角度(Non-OOP to OOP), 另一个是<strong>数据和函数的关系</strong>角度(命令式编程(函数围绕数据)和函数式编程(数据围绕函数))。</p>

<p>命令式编程和函数式编程的区别有如下几点：</p>

<ol>
  <li>从<strong>数据的可变性</strong>角度，命令式编程专注于<strong>逐步更改可变数据</strong>，函数式编程专注于<strong>转换不可变数据</strong>。但函数式编程也可以保存state，只不过他们不用变量来保存，而是用函数的输入参数保存(存在函数调用的栈中)。同时variable在命令式编程中更是一个存储数据的容器，可以更改，而variable在函数式编程中只是数据的一个名字，不能更改。</li>
  <li>从<strong>函数的副作用</strong>角度，命令式编程的Function允许<strong>有副作用</strong>，比如有一个函数<code class="highlighter-rouge">trimFileNames()</code>，从当前文件夹读入子文件夹，处理它们的名字(去掉空格)，然后存储文件夹名字。在这个过程中，<code class="highlighter-rouge">trimFileNames()</code>涉及如何获取input data，处理input data 得到result data，最后如何利用result data。函数式编程的Function<strong>不允许有副作用</strong>，它不关心(也不用关心)如何获取input data和如何利用result data，他只要有一个映射，将input data 转成 result data 返回即可。</li>
  <li>从<strong>数据和函数的关系</strong>角度，命令式编程是<strong>函数围绕数据</strong>，对数据进行读，改，存；函数式编程是<strong>数据围绕函数</strong>，函数是一等公民。</li>
  <li>从<strong>多线程</strong>角度，命令式编程由于数据的可变性，因此不同线程对同一个全局变量的赋值会导致不同的结果<strong>(Non-deterministic = Parallel Programming + Mutable data)</strong>，不同线程之间的纠缠会令编程异常困难，但是同时对于存储空间的要求并不高，因为数据可以共享。函数式编程由于数据的不可变性，因此不同线程对于<strong>不可变数据共享是安全的</strong>，函数式编程是处理多线程的一个有效编程范式。也就是说从<strong>时间的角度</strong>，命令式编程将时间作为一个变量加入到程序里(改变量)，而函数式编程将时间排除在外(任何时候你调用一个函数，只要输入一样，输出肯定一样)。</li>
  <li>函数式编程可以使得很多OOP中<strong>设计模式</strong>所需要解决的问题全然消失。因此<strong>设计模式</strong>对于函数式是个伪命题，就像跟开飞机的讨论开汽车面临的路面交通拥挤一样。</li>
</ol>

<p>如何将OOP和命令式编程结合已经是上个世纪50s年代的事情了，到现在21世纪的20s年代，OOP已经发展的非常成熟了，我们现在用的Java，Objective-C，C++，C#都是这一结合的典范。如何将OOP和函数式编程结合却是刚刚崭露头角的编程的研究方向。Scala语言正是基于这一理念发展起来，而现在苹果开发的Swift更是将OOP，命令式编程与函数式编程结合起来（Swift的函数式语法和理念和Scala相似，由于Scala先于Swift存在，因此有理由相信Swift是借鉴于Scala）。</p>

<p>因此如果要扎实地学好Swift，除了从Objective-C入手外，还得熟悉Scala。下面我们来看看Scala的<strong>函数(Function)</strong>和<strong>赋值(Evaluation)</strong>。</p>

<h2 id="calculus">2 函数式编程的理论基础：λ-Calculus</h2>

<p>既然认识了函数式编程，那么你肯定会问它三个终极问题：</p>

<ol>
  <li>你是谁？</li>
  <li>你从哪里来？</li>
  <li>你到哪里去？</li>
</ol>

<p>下面我们来聊聊函数式编程的前世今生。</p>

<p>在上个世纪30s年代，正是美国经历大萧条的时期。经济萧条就像病毒一样，扩散到美国每一寸土地，老百姓衣不遮体，食不果腹(万恶的资本主义社会啊)。但是在美国的一个角落里，却有那么一些人免于贫瘠带来的生活上的困扰。他们每天端着一杯咖啡穿梭于宽敞的办公室，和幽静的花园小径，讨论着高深莫测的学术问题。这个角落就是Princeton大学，在这些人中，有四位专注于研究<strong>形式系统(formal system)</strong>的数学家叫做<strong>Alonzo Church</strong>，<strong>Alan Turing</strong>，<strong>John von Neumann</strong>和<strong>Kurt Gödel</strong>。他们的工作的共同之处在于研究<strong>计算(Computation)</strong>：如果我们有一台拥有无限计算能力的电脑，我们能解决什么类型的问题，是否能自动解决这些问题，是否有一些问题是在其能力范围外的？其中有一个问题是：</p>

<blockquote>
  <p>不同设计的机器是否在计算能力上等价?</p>
</blockquote>

<p>为了回答这个问题，<strong>Alonzo Church</strong>在与其他人的合作中创造出一套名叫<strong>λ-Calculus</strong>的<strong>形式系统</strong>。<strong>λ-Calculus</strong>的本质是以函数作为输入输出的<strong>函数</strong>为中心的一门<strong>编程语言</strong>（由于那个时候计算机还没发展起来，更准确的说其实不是<strong>编程语言</strong>而是建立在虚拟计算机上的一套<strong>计算规则</strong>）。这句话我们现在来讲就是<strong>λ-Calculus</strong>的本质是<strong>函数(包括一阶和高阶函数)</strong>。</p>

<p>同时<strong>Alan Turing</strong>也在进行着相近的工作，他创造出一套不同的<strong>形式系统</strong>：<strong>图灵机(Turing machine)</strong>(当时应该不叫这个名字吧，会取自己的名字么)。不久后</p>

<blockquote>
  <p><strong>λ-Calculus</strong>和<strong>Turing machine</strong>被证明在计算能力上是等价的。
<strong>命令式编程和函数式编程分别基于图灵机和λ-Calculus发展起来</strong>。
因此命令式编程和函数式编程的计算能力是等价的。</p>
</blockquote>

<p>下面我们具体来看看<strong>λ-Calculus</strong>以及基于它的<strong>λ expression</strong>的定义：</p>

<blockquote>
  <p><strong>λ演算(λ-Calculus)</strong>的中心是<strong>&lt;expression&gt;</strong>，它被递归定义如下：<br />
<strong>&lt;expression&gt;</strong>   := <strong>&lt;const&gt;</strong> |<strong>&lt;variable&gt;</strong> | <strong>&lt;function&gt;</strong> |<strong>&lt;application&gt;</strong><br />
<strong>&lt;function&gt;</strong>   := <strong>λ&lt;variable&gt;</strong>.<strong>&lt;expression&gt;</strong><br />
<strong>&lt;application&gt;</strong>  := <strong>&lt;expression&gt;</strong><strong>&lt;expression&gt;</strong></p>
</blockquote>

<blockquote>
  <p><strong>λ表达式(λ expression)</strong>：an anonymous function that you can use to create delegates or expression tree types. By using lambda expressions, you can write <strong>local functions</strong> that can be <strong>passed as arguments</strong> or <strong>returned as the value</strong> of <strong>function calls</strong>.</p>
</blockquote>

<h3 id="expression">2.1 表达式(Expression)</h3>

<p>其中<strong>λ-Calculus</strong>的核心是<strong>&lt;expression&gt;</strong>，它可以是这几种组合：</p>

<ol>
  <li><strong>&lt;expression&gt;</strong> 即可以是一个<strong>&lt;const&gt;</strong>(常量)，一个<strong>&lt;variable&gt;</strong>(变量)，一个<strong>&lt;function&gt;</strong>，也可以是一个<strong>&lt;application&gt;</strong>；</li>
  <li><strong>&lt;function&gt;</strong>用一个<strong>λ</strong>关键词，后面紧跟输入参数<strong>&lt;variable&gt;</strong>和函数的body<strong>&lt;expression&gt;</strong>，这其实就是我们熟知的匿名函数的定义；</li>
  <li><strong>&lt;applicaton&gt;</strong>第一个<strong>&lt;expression&gt;</strong>可以是<strong>&lt;function&gt;</strong>，第二个<strong>&lt;expression&gt;</strong>可以是<strong>&lt;variable&gt;</strong>或者<strong>&lt;const&gt;</strong>。这其实就是函数的调用。注意<strong>λ-Calculus</strong>的<strong>&lt;function&gt;</strong>只有一个输入变量<strong>&lt;variable&gt;</strong>。</li>
</ol>

<p>下面举个栗子：</p>

<p class="img_middle_lg"><img src="/assets/images/posts/2015-10-01/λ Calculus vs Scala.png" alt="λ Calculus vs Scala" /></p>

<h3 id="function--block">2.2 函数(Function) 和 Block(匿名函数)</h3>

<p>在<strong>λ-Calculus</strong>里，我们定义了<strong>Primitive Data Type</strong>(int，doulbe，boolean等)和<strong>Primitive Procedure</strong>(， +，-，*，/，和<a href="http://www.shunmian.me/functional%20programming/2015/10/01/Functional-Programming-in-Scala(一)_λ-演算-Part-I-表达式-函数和赋值.html#conditonals">conditionals</a>）。如何运用Primitive Procedure来创造Compound Procedure从而可以更模块化，更抽象化地提高语言的表达能力呢？这个时候我们就要用到函数了。</p>

<blockquote>
  <p><strong>Function</strong>：the compound procedure based on primitive procedures to improve modularity，conceptual level and expressive ability of the language.</p>
</blockquote>

<p>因此函数就是复合型基础操作。</p>

<p>其实函数和变量在形式上是一回事，定义的时候有<strong>关键词</strong>，有<strong>名字</strong>，有<strong>类型</strong>，有<strong>字面值(Literal)</strong>。匿名函数(Block)是函数的<strong>字面值</strong>，只不过在写匿名函数的时候需要显式注明输入输出类型，如<code class="highlighter-rouge">(x：Int):Int =&gt;x*x</code>而不是只写<code class="highlighter-rouge">x*x</code>;由于变量的字面值可以推断其类型，因此匿名值(应该没有这个叫法吧，这里指字面值)直接写字面值即可，如3表示整型。</p>

<p class="img_middle_mid"><img src="/assets/images/posts/2015-10-01/function and variable.png" alt="function and variable" /></p>

<p>接下来我们来看看Block。</p>

<blockquote>
  <p><strong>Block</strong>：借用《Pro Multithreading and Memory Management for iOS and OS X》书中，Kazuki Sakamoto 对block的定义“拥有自动变量（可以在block声明的语义环境里捕捉变量的状态）的匿名（使函数体(code)成为和数据(data)一样的一等公民，作为函数调用时输入的实参（argument））函数。”</p>
</blockquote>

<p>由于block可以看到上下文中的变量，因此<a href="http://www.shunmian.me/functional%20programming/2015/10/01/Functional-Programming-in-Scala(一)_λ-演算-Part-I-表达式-函数和赋值.html#conditonals">2.4Conditionals</a>中的<code class="highlighter-rouge">sqrt</code>函数可以在内部定义的函数里取消<code class="highlighter-rouge">x</code>作为输入参数。</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">def</span> <span class="n">sqrt2</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>

    <span class="k">def</span> <span class="n">abs</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">-</span><span class="n">x</span> <span class="k">else</span> <span class="n">x</span>

    <span class="k">def</span> <span class="n">sqrtIter</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">isGoodEnough</span><span class="o">(</span><span class="n">guess</span><span class="o">))</span> <span class="n">guess</span>
      <span class="k">else</span> <span class="n">sqrtIter</span><span class="o">(</span><span class="n">improved</span><span class="o">(</span><span class="n">guess</span><span class="o">))</span>

    <span class="k">def</span> <span class="n">isGoodEnough</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
      <span class="n">abs</span><span class="o">(</span><span class="n">guess</span> <span class="o">*</span> <span class="n">guess</span> <span class="o">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">/</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.000001</span>

    <span class="k">def</span> <span class="n">improved</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
      <span class="o">(</span><span class="n">guess</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">guess</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">sqrtIter</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">}</span>                                        

  <span class="n">sqrt2</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>                                 <span class="c1">//&gt; res5: Double = 1.4142135623746899
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>                                  <span class="c1">//&gt; res6: Double = 2.000609756097561
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span><span class="o">)</span>                               <span class="c1">//&gt; res7: Double = 0.0010000001533016628
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">1</span><span class="n">e60</span><span class="o">)</span>                               <span class="o">//&gt;</span> <span class="n">res8</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.0000788456669446E30</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="application">2.3 赋值(Application)</h3>

<p>赋值英文有些地方用Evaluation可能更准确。</p>

<blockquote>
  <p><strong>值替换模型(Substituion Model)</strong>：由于不依赖外部变量，给定<strong>输入</strong>函数的返回<strong>结果永远不变</strong>，在<strong>λ演算的基础上</strong>，我们可以用值替换的方式（substitutionmodel）化繁为简，轻松得出一段程序的计算结果。</p>
</blockquote>

<blockquote>
  <p><strong>赋值(Application)</strong>：函数的值替换动作，即<strong>λ-Calculus</strong>定义里的<strong>&lt;application&gt;</strong>，也就是<strong>&lt;function&gt;</strong> 的调用。</p>
</blockquote>

<p>关于值替换模型，我们可以看下面这个例子，<code class="highlighter-rouge">sumOfSquare(3,4)</code>就是一步步将函数替换成函数的返回值<strong>(不断赋值)</strong>。</p>

<p class="img_middle_hg"><img src="/assets/images/posts/2015-10-01/evaluation.png" alt="evaluation" /></p>

<ul>
  <li>赋值的策略有两种：<strong>Call-By-Value(CBV)</strong>，<strong>Call-By-name</strong>；</li>
  <li><strong>CBV</strong>先reduce argument，再evaluate Function；<strong>CBN</strong>use unreduced argument to evaluate Function；</li>
  <li>在Scala里，默认<code class="highlighter-rouge">x:Int</code>形式是CBV，如果要CBN，则用<code class="highlighter-rouge">x: =&gt;Int</code>。</li>
  <li>如果一个函数CBV terminates(不会无限循环)，则CBN也terminates。反之不成立，反例请看下图。</li>
  <li><code class="highlighter-rouge">def</code>，定义函数的关键字，是CBN，<code class="highlighter-rouge">val</code>，定义变量（不可变）的关键字，是CBV。</li>
</ul>

<h3 id="conditonals">2.4 Conditonals</h3>

<p>Scala也用if-else来执行条件语句，我们看下面这个例子用牛顿方法计算平方根<code class="highlighter-rouge">sqrt(x: Double):Double</code>：</p>

<ol>
  <li>给定一个猜测的值<code class="highlighter-rouge">guess</code>，求<code class="highlighter-rouge">x/guess</code>；</li>
  <li>若<code class="highlighter-rouge">guess</code>与<code class="highlighter-rouge">x/guess</code>的差值&lt;某个很小的值，则返回该值；如果大于，则用<code class="highlighter-rouge">(guess + x/guess)/2</code>代替<code class="highlighter-rouge">guess</code>继续第一步。</li>
</ol>

<p>我们来看具体代码：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre>  <span class="k">def</span> <span class="n">sqrt</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>
  
    <span class="k">def</span> <span class="n">abs</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">-</span><span class="n">x</span> <span class="k">else</span> <span class="n">x</span>

    <span class="k">def</span> <span class="n">sqrtIter</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">isGoodEnough</span><span class="o">(</span><span class="n">guess</span><span class="o">,</span> <span class="n">x</span><span class="o">))</span> <span class="n">guess</span>
      <span class="k">else</span> <span class="n">sqrtIter</span><span class="o">(</span><span class="n">improved</span><span class="o">(</span><span class="n">guess</span><span class="o">,</span> <span class="n">x</span><span class="o">),</span> <span class="n">x</span><span class="o">)</span>

    <span class="k">def</span> <span class="n">isGoodEnough</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
      <span class="n">abs</span><span class="o">(</span><span class="n">guess</span> <span class="o">*</span> <span class="n">guess</span> <span class="o">-</span> <span class="n">x</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span>

    <span class="k">def</span> <span class="n">improved</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
      <span class="o">(</span><span class="n">guess</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">guess</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">sqrtIter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">x</span><span class="o">)</span>
  <span class="o">}</span>                                       
  
  <span class="n">sqrt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>                                <span class="c1">//&gt; res1: Double = 1.4142156862745097
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>                                <span class="c1">//&gt; res2: Double = 2.0000000929222947
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span><span class="o">)</span>                             <span class="c1">//&gt; res3: Double = 0.031260655525445276|
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">1</span><span class="n">e60</span><span class="o">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>我们可以看到sqrt(2)和sqrt(4)的值都是正确的，但是当输入x很小(结果不准确)或者很大时(无限循环)该函数运行结果不正确。原因在于<code class="highlighter-rouge">isGoodEnough(guess: Double, x: Double): Boolean</code>这个函数不应该用绝对值比较，而应该和输入的x做相对比较(因为x很小时，0.001不够小；x很大时，不会记录小数点后3三位，无法收敛导致无限循环)，我们将其改为如下：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="o">{</span>
<span class="o">...</span>
    <span class="k">def</span> <span class="n">isGoodEnough</span><span class="o">(</span><span class="n">guess</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
      <span class="n">abs</span><span class="o">(</span><span class="n">guess</span> <span class="o">*</span> <span class="n">guess</span> <span class="o">-</span> <span class="n">x</span><span class="o">)/</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.001</span>
<span class="o">...</span>
<span class="o">}</span>

  <span class="n">sqrt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>                                <span class="c1">//&gt; res1: Double = 1.4142156862745097
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>                                <span class="c1">//&gt; res2: Double = 2.000609756097561
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span><span class="o">)</span>                             <span class="c1">//&gt; res3: Double = 0.0010000001533016628
</span>  <span class="n">sqrt</span><span class="o">(</span><span class="mi">1</span><span class="n">e60</span><span class="o">)</span>                             <span class="o">//&gt;</span> <span class="n">res4</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.0000788456669446E30</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>此时运行结果是正确的。</p>

<h3 id="tail-recursion">2.5 Tail Recursion</h3>

<p>要理解尾递归得先理解递归，那么什么是递归呢？</p>

<p class="img_middle_mid"><img src="/assets/images/posts/2015-10-01/recursion0.png" alt="recursion0" /></p>

<p>开个玩笑，递归应该是长这样子的。</p>

<p class="img_middle_lg"><img src="/assets/images/posts/2015-10-01/recursion.png" alt="recursion" /></p>

<p>同学们一般对于递归函数感觉是块不好啃的硬骨头。其实递归函数用数学归纳法去理解并不困难。</p>

<blockquote><b>数学归纳法</b>的思想如下，一般地，证明一个与自然数n有关的命题P(n），有如下步骤：

<ul>
<li><b>step1</b> 证明当n取第一个值n<sub>0</sub>时命题成立。n<sub>0</sub>对于一般数列取值为0或1，但也有特殊情况；</li>
<li><b>step2</b> 假设当n=k（k≥n0，k为自然数）时命题成立，证明当n=k+1时命题也成立。</li>
<li><b>综合（1）（2）</b>，对一切自然数n（≥n<sub>0</sub>），命题P(n）都成立。</li>
</ul>

</blockquote>

<p>其实，数学归纳法利用的是递推的原理，形象地可以叫做多米诺原理。因为N+1的成立就可以向前向后递推所有数都成立。
因此我们再回头看上面的尾递归版本的阶乘函数。n==0时，是退出条件。</p>

<p>在理解了递归函数后，我们看看什么是尾递归。</p>

<blockquote>
  <p><strong>尾递归(Tail Recursion)</strong>
：一个函数中所有递归形式的调用都出现在函数的末尾，且递归函数的返回值不属于表达式的一部分时，称为尾递归。</p>
</blockquote>

<p>下面举两个栗子：</p>

<p>第一个栗子是求最大公约数gcd(GGreatest common divisor。第二个是求阶乘。</p>

<p class="img_middle_lg"><img src="/assets/images/posts/2015-10-01/tail recursion.png" alt="tail recursion" /></p>

<p>由于第n次阶乘的表达式的一部分(这里是 n *)都需要保留在<strong>栈</strong>中，每当进入一个函数调用，栈就会加一层<strong>栈帧</strong>，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致<strong>栈溢出</strong>。我们应在递归函数中<strong>尽量使用尾递归避免栈溢出</strong>。</p>

<p>那么我们可以改写阶乘函数为尾递归函数吗，答案是肯定的，请看下面代码：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre> <span class="k">def</span> <span class="n">factorial</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">factLoop</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span> <span class="n">acc</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="o">)</span> <span class="n">acc</span>
        <span class="k">else</span> <span class="n">factLoop</span><span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="n">acc</span> <span class="o">*</span> <span class="n">n</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">factLoop</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="mi">1</span><span class="o">)</span>
 <span class="o">}</span>                                                <span class="c1">//&gt; factorial: (n: Int)Int
</span>
 <span class="n">factorial</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>                                     <span class="o">//&gt;</span> <span class="n">res2</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">24</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这个新改写的函数每次调用factLoop的时候，返回下一个factLoop的值。</p>

<h2 id="assignment">3 Assignment</h2>

<p class="img_middle_lg"><img src="/assets/images/posts/2015-10-01/assignment.png" alt="Assignment" /></p>

<ul>
  <li><strong>Pascal triangle</strong>：递归比较简单，退出条件也很明显，分别是<code class="highlighter-rouge">c==0</code>和<code class="highlighter-rouge">c==r</code>的时候；</li>
  <li><strong>Parenthesis Balance</strong>：用一个<code class="highlighter-rouge">acc：Int</code>来存储，每遇见一个<code class="highlighter-rouge"><span class="p">{</span></code>+1,<code class="highlighter-rouge">}</code>-1。退出条件是<code class="highlighter-rouge">chars.isEmpty</code>或者<code class="highlighter-rouge">acc &lt; 0</code>；</li>
  <li><strong>Counting Money</strong>稍微需要仔细思考，退出条件是<code class="highlighter-rouge">Money == 0</code>，和<code class="highlighter-rouge">Money &lt; 0 || coins.isEmpty</code>。</li>
</ul>

<p>具体代码见<a href="https://github.com/shunmian/-2_Functional-Programming-in-Scala">这里</a>。</p>

<h2 id="section-1">4 总结</h2>

<p>本节我们首先对什么是函数式编程做了一个总结：</p>

<ol>
  <li>函数无副作用；</li>
  <li>通过函数转换不可变数据而非改变原有数据来获取新数据；</li>
  <li>数据围绕函数而非函数围绕数据，函数也是一等公民。</li>
</ol>

<p>在这基础上，我们回顾了作为函数式编程理论基础的<strong>λ-Calculus</strong>。<strong>λ-Calculus</strong>里最重要的3个概念是<strong>&lt;expression&gt;</strong>，<strong>&lt;function&gt;</strong>， <strong>&lt;application&gt;</strong>。<strong>&lt;function&gt;</strong>就是函数，<strong>&lt;application&gt;</strong>可以理解成函数调用。以函数为基础的<strong>λ-Calculus</strong>和以操作为基础的<strong>图灵机</strong>在计算能力上被证明是等价的，任何计算形式都可以被他们实现。现在的<strong>函数式编程</strong>和<strong>命令式编程</strong>正是基于<strong>λ-Calculus</strong>和<strong>图灵机</strong>发展过来。函数式编程的未来发展方向是和OOP结合，这也就是Scala背后的设计哲学。</p>

<p>对于函数，通过函数和变量的声明与定义的比较，可以看出他们同样拥有<strong>关键词</strong>，<strong>名称</strong>，<strong>类型</strong>，<strong>字面值</strong>，因此有理由在一个更抽象的层面将函数和变量统一对待。函数中<strong>类型 + 数据(其实是函数体)</strong>就是<strong>匿名函数</strong>，也就是<strong>Block</strong>。</p>

<h2 id="section-2">5 参考资料</h2>
<ul>
  <li><a href="https://mitpress.mit.edu/sicp/full-text/book/book.html">《Structure and Interpretation of Computer Programs》</a>;</li>
  <li><a href="https://www.youtube.com/watch?v=kkTFx3-duc8">Martin Odersky: Scala with Style</a>;</li>
  <li><a href="https://www.youtube.com/watch?v=ecekSCX3B4Q">SF Scala: Martin Odersky, Scala – the Simple Parts</a>;</li>
</ul>


            <div class="clearfix"></div>
        </div>


    
    <ul class="tag_box list-unstyled list-inline">
      <li><i class="fa fa-folder-open"></i></li>
      
      
      
        <li><a href="http://www.shunmian.me/categories.html#Functional Programming-ref">
          Functional Programming <span>(8)</span>
          
        </a></li>
      
      
    </ul>
    

    
    <ul class="list-inline">
      <li><i class="fa fa-tags"></i></li>
      
      
      
        <li>
          <a href="http://www.shunmian.me/tags.html#λ-Calculus-ref">
          λ-Calculus <span>(1)</span>
          ,
          </a>
        </li>
      
        <li>
          <a href="http://www.shunmian.me/tags.html#Expression-ref">
          Expression <span>(1)</span>
          ,
          </a>
        </li>
      
        <li>
          <a href="http://www.shunmian.me/tags.html#Function-ref">
          Function <span>(1)</span>
          ,
          </a>
        </li>
      
        <li>
          <a href="http://www.shunmian.me/tags.html#Application-ref">
          Application <span>(1)</span>
          
          </a>
        </li>
      
      
      
    </ul>
    

<hr />
<div >
    <section class="col-sm-7">
        <h4>Share Post</h4>
        <a class="btn btn-default btn-sm" href="http://twitter.com/share?text=FP in Scala(一)：λ-演算 Part I：表达式，函数和赋值&via=Wanderl29817400" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fa fa-twitter fa-sm"></i>
        Twitter
        </a>

        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-sm"></i>
          Facebook
        </a>

        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-sm"></i>
          Google+
        </a>
    </section>

    <section class="col-sm-5">
        <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df" class="img-rounded" />
        <h4>Shunmian</h4>
        <p class="author-bio">节物风光不相待，桑田碧海须臾改，唯有美食和code不可辜负。</p>

    </section>

</div>
<div class="clearfix"></div>

<ul class="pager">
    
    <li class="previous"><a href="http://www.shunmian.me/algorithm/2015/09/07/Algorithm(%E4%BA%94)_Graph-%E5%9B%BE-part-II.html" title= "">&larr; Previous</a></li>
    
    
    <li class="next">"<a href="http://www.shunmian.me/functional%20programming/2015/10/02/Functional-Programming-in-Scala(%E4%B8%80)_%CE%BB-%E6%BC%94%E7%AE%97-Part-II-%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E5%92%8C%E6%9F%AF%E9%87%8C%E5%8C%96.html" title= "FP in Scala(一)：λ-演算 Part II：高阶函数和柯里化">Next &rarr;</a></li>
    
</ul>

    <hr />
    
    <section class="comments" style="margin-top:15px;">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shunmianjohnson'; // required: replace example with your forum shortname
        if(disqus_shortname){
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        }
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
    
    </div>
    <div class="col-sm-1sidebar-2"></div>
    <div class="clearfix"></div>
</article>
<div class="clearfix"></div>


                <div class="footer">
                    <footer>
                        <hr />
                        <p> &copy: 2015 Shunmian with jekyll. Theme: <a href="https://github.com/dbtek/dbyll"dbyll</a> by dbtek.
                        </p>
                    </footer>
                </div>
            </div>
        </div>
    </div>


    <script src="/assets/js/jquery-2.2.0.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/script.js"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
    <script type="text/javascript">

$youziku.load(".sidebar_bio", "bdcc72b8235345649b02c123dac5610b", "SiYuan-ExtraLight");


   $youziku.draw();
</script>

</body>

</html>

