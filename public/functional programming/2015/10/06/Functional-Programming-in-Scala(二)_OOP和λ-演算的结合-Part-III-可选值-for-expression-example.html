<!DOCTYPE html>
<html lang = "en">
<head>
    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/posts/favico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/posts/favico/favico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/posts/favico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/posts/favico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/posts/favico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/posts/favico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/posts/favico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/posts/favico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/posts/favico/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/posts/favico/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/posts/favico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/posts/favico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/posts/favico/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/posts/favico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/assets/images/posts/favico/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">   

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/font-awesome/css/font-awesome.min.css">
    <link href="/assets/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>
<!--     <script type="text/javascript" src="http://api.youziku.com/webfont/FastJS/yzk_976E121ED7CC0870"></script> -->

    <title>SHUNMIAN</title>
</head>


<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 sidebar hidden-xs sidebar">
                
<!--sidebar.html-->
        <header class="sidebar_header " role="banner">
            <a href="http://www.shunmian.me/index.html">
                <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df?s=150" class="img-circle img-responsive center-block sidebar_logo sidebar_img" />
            </a>


            <h3 class="title text-center">
                <a href="http://www.shunmian.me/index.html">SHUNMIAN</a>
            </h3>

        </header>


        <hr class="hr_short"/>
        <div id = "bio" class="text-center sidebar_bio">
            

                <p>嗨，欢迎来到我的博客。<br/>
                我是Shunmian，一名iOS开发者。<br/>
                <hr class = "hr_short_low">
                正在学习Algorithm，Functional Programming，Machine Learning，Data Mining 和 Cloud Computation。 

                </p>

            
        </div>


        <hr class="hr_middle"/>
        <div id = "contact-list" class="text-center">
            <ul class="list-unstyled list-inline">
                <li>
                    
                    <a class="btn btn_info_outline" href="mailto:shunmian@gmail.com"><i class="fa fa-envelope fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-github fa-lg"></i></a>
                    
                </li>

                <li>
                    
                    <a class="btn btn_info_outline" href="https://github.com/shunmian"><i class="fa fa-twitter fa-lg"></i></a>
                    
                </li>

                <li>
                    <a class="btn btn_info_outline" href="http://www.shunmian.me/feed.xml"><i class="fa fa-rss fa-lg"></i></a>
                </li>
        </div>


        <hr class="hr_short"/>
        <div id = "contact-list" class="text-center">
            <ul class="unstyled-list list-inline">
                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/index.html"><i class="fa fa-home fa-md"></i> 主页</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/tags.html"><i class="fa fa-tags fa-md"></i> 标签</a>
                </li>

                <li>
                    <a class="btn btn_info_outline btn-sm" href="http://www.shunmian.me/categories.html"><i class="fa fa-list fa-md"></i> 分类</a>
                </li>
            </ul>
        </div>
        <div class="padding_bottom_500"></div>




<!--sidebar.html end-->

            </div>

            <div class="col-sm-9 col-sm-offset-3">
                

<div class="page-header col-sm-10 col-sm-offset-1">
    <h1 class="article_mainTitle">FP in Scala(二)：OOP和λ-演算的结合 Part III：可选值，for-exp </h1>
    <span class="post_date">
        2015-10-06 •
    </span>
    <span class="post_category">
        Functional Programming
    </span>
</div>

<article class="article">
    <div class="col-sm-10 col-sm-offset-1">
        <div class="article_mainBody">
            <p class="article_content_title">目录</p>

<ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">1. 介绍</a></li>
  <li><a href="#collection" id="markdown-toc-collection">2. collection</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">2.1 可选值</a></li>
      <li><a href="#for-expression" id="markdown-toc-for-expression">2.2 for-expression</a>        <ul>
          <li><a href="#for-expression-1" id="markdown-toc-for-expression-1">2.2.1 for-expression语法</a></li>
          <li><a href="#for-expression-as-query-for-database" id="markdown-toc-for-expression-as-query-for-database">2.2.2 for-expression as Query for Database</a></li>
        </ul>
      </li>
      <li><a href="#section-2" id="markdown-toc-section-2">2.3 例子</a></li>
    </ul>
  </li>
  <li><a href="#assignment" id="markdown-toc-assignment">3 Assignment</a></li>
  <li><a href="#section-3" id="markdown-toc-section-3">4 总结</a></li>
  <li><a href="#section-4" id="markdown-toc-section-4">5 参考资料</a></li>
</ul>

<hr class="hr-short-left" />

<h2 id="section">1. 介绍</h2>

<h2 id="collection">2. collection</h2>

<h3 id="section-1">2.1 可选值</h3>

<blockquote>
  <p><strong>Option(可选值)</strong>：有两个子类，一个是None，一个是Some。这是Scala表示有和无的一种处理。我们再回顾下上文中<code class="highlighter-rouge">Map</code>的<code class="highlighter-rouge">get</code>方法。</p>
</blockquote>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>  <span class="k">val</span> <span class="n">capitalOfCountry</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">"US"</span><span class="o">-&gt;</span><span class="s">"Washington"</span><span class="o">,</span><span class="s">"Switzerland"</span><span class="o">-&gt;</span><span class="s">"Bern"</span><span class="o">)</span>
                                                  <span class="c1">//Map(US -&gt; Washington, Switzerland -&gt; Bern)
</span>  <span class="n">capitalOfCountry</span><span class="o">(</span><span class="s">"US"</span><span class="o">)</span>                          <span class="c1">//String = Washington
</span>  <span class="n">capitalOfCountry</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"China"</span><span class="o">)</span>                   <span class="c1">//Option[String] = None
</span>  <span class="n">capitalOfCountry</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"US"</span><span class="o">)</span>                      <span class="o">//</span><span class="nc">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">Washington</span><span class="o">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>有和无的处理一直是programming中的一个无法避免的问题，有些时候，函数返回非正常值来代替无，比如<code class="highlighter-rouge">List</code>的方法<code class="highlighter-rouge">indexOf(x)</code>返回下标若有x，返回-1若没有x。这会带来一些额外的问题，比如编程者需要把结果和-1判断才能知道是不是有x，这就提前假定了编程者知道-1在<code class="highlighter-rouge">List</code>类里的含义。如果我们用<code class="highlighter-rouge">Option</code>就不需要有这种担忧，直接和<code class="highlighter-rouge">None</code>比较即可。<code class="highlighter-rouge">Swift</code>中对于<code class="highlighter-rouge">Option</code>有大量的应用，只要随便翻开<code class="highlighter-rouge">Swift</code>的代码，里面一定充满了<code class="highlighter-rouge">?</code>和<code class="highlighter-rouge">!</code>，这就是对于<code class="highlighter-rouge">Option</code>的拆包的操作。</p>

<h3 id="for-expression">2.2 for-expression</h3>

<p>Scala的函数式也有自己的for循环的语法，相比较于命令式的for循环，scala的for循环更简洁，而且是基于对数据的转换而不是更改。下面举一个栗子。</p>

<blockquote>
  <p><strong>质数问题</strong>：给定一个自然数n，求所有的组合(i,j)，满足i+j为质数，且1&lt;=j&lt;i&lt;N。</p>
</blockquote>

<p>我们用之前的高阶函数的实现如下：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>  <span class="k">def</span> <span class="n">isPrime</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Boolean</span> <span class="o">=</span> <span class="o">(</span><span class="mi">2</span> <span class="n">until</span> <span class="n">n</span><span class="o">).</span><span class="n">forall</span><span class="o">(</span><span class="n">x</span><span class="k">=&gt;</span><span class="n">n</span><span class="o">%</span><span class="n">x</span><span class="o">!=</span> <span class="mi">0</span><span class="o">)</span>
  
  <span class="k">def</span> <span class="n">primeCombs1</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">=</span> <span class="o">((</span><span class="mi">1</span> <span class="n">until</span> <span class="n">n</span><span class="o">).</span><span class="n">flatMap</span><span class="o">(</span><span class="n">i</span><span class="o">=&gt;(</span><span class="mi">1</span> <span class="n">until</span> <span class="n">i</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">j</span><span class="o">=&gt;(</span><span class="n">i</span><span class="o">,</span><span class="n">j</span><span class="o">)))).</span><span class="n">filter</span><span class="o">(</span><span class="n">pair</span><span class="k">=&gt;</span><span class="n">isPrime</span><span class="o">(</span><span class="n">pair</span><span class="o">.</span><span class="n">_1</span> <span class="o">+</span> <span class="n">pair</span><span class="o">.</span><span class="n">_2</span><span class="o">))</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>这种语法看起来不是非常容易理解。那么如果我们用Scala的for循环语句的实现是什么样子呢？</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>  <span class="k">def</span> <span class="n">isPrime</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Boolean</span> <span class="o">=</span> <span class="o">(</span><span class="mi">2</span> <span class="n">until</span> <span class="n">n</span><span class="o">).</span><span class="n">forall</span><span class="o">(</span><span class="n">x</span><span class="k">=&gt;</span><span class="n">n</span><span class="o">%</span><span class="n">x</span><span class="o">!=</span> <span class="mi">0</span><span class="o">)</span>
  
  <span class="k">def</span> <span class="n">primeCombs2</span><span class="o">(</span><span class="n">n</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">=</span>
  	<span class="k">for</span><span class="o">{</span>
  		<span class="n">i</span><span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">n</span>      <span class="c1">//generator，遍历范围
</span>  		<span class="n">j</span><span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">i</span>
  		<span class="k">if</span> <span class="n">isPrime</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">)</span>    <span class="c1">//filter，遍历过滤
</span>  	<span class="o">}</span> <span class="k">yield</span><span class="o">(</span><span class="n">i</span><span class="o">,</span><span class="n">j</span><span class="o">)</span>  		   <span class="o">//</span><span class="k">yield</span><span class="err">，</span><span class="n">遍历业务逻辑</span><span class="err">。</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>for语句使得我们的代码看起来更简洁易懂。</p>

<h4 id="for-expression-1">2.2.1 for-expression语法</h4>

<p><code class="highlighter-rouge">for-expression</code>的语法有三部分：</p>

<ol>
  <li><code class="highlighter-rouge">generator</code>，也就是for循环的单个元素。“左边&lt;-右边” 表示左边是右边(Collection)的元素。<code class="highlighter-rouge">genertor</code>后面可以再跟<code class="highlighter-rouge">generator</code>表示嵌套；</li>
  <li><code class="highlighter-rouge">filter</code>跟在<code class="highlighter-rouge">generator</code>后面，用<code class="highlighter-rouge">if</code>表示；</li>
  <li><code class="highlighter-rouge">yield</code>表示对于<code class="highlighter-rouge">for{}</code>里的每个符合filter的来自generator的元素，我们的处理。这里是生成一个<code class="highlighter-rouge">tuple(i,j)</code>。最后的结果这里是<code class="highlighter-rouge">IndexedSeq[(Int,Int)]</code>。我们可以将结果<code class="highlighter-rouge">toList</code>转成List。</li>
</ol>

<p>总结起来<code class="highlighter-rouge">generator</code>和<code class="highlighter-rouge">filter</code>分别是遍历范围和条件，而<code class="highlighter-rouge">yield</code>是遍历业务逻辑。</p>

<h4 id="for-expression-as-query-for-database">2.2.2 for-expression as Query for Database</h4>
<p>由于Scala <strong>for-expression</strong>的简洁强大，它可以用于<strong>数据库查询</strong>。我们看下面这个例子。</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre>  <span class="k">case</span> <span class="k">class</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">authors</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>
  
  <span class="k">val</span> <span class="n">books</span><span class="k">:</span><span class="kt">List</span><span class="o">[</span><span class="kt">Book</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="k">new</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">"Structure and Interpretation of Computer Programs"</span><span class="o">,</span> <span class="n">authors</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">"Abelson, Harald"</span><span class="o">,</span> <span class="s">"Sussman, Gerald J."</span><span class="o">)),</span>
                	 <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">"Introduction to Functional Programming"</span><span class="o">,</span> <span class="n">authors</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">"Bird, Richard"</span><span class="o">,</span> <span class="s">"Wadler, Phil"</span><span class="o">)),</span>
                	 <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">"Effective Java"</span><span class="o">,</span> <span class="n">authors</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">"Bloch, Joshua"</span><span class="o">)),</span>
                	 <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">"Effective Java2"</span><span class="o">,</span> <span class="n">authors</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">"Bloch, Joshua"</span><span class="o">)),</span>
                	 <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">"Java Puzzlers"</span><span class="o">,</span> <span class="n">authors</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">"Bloch, Joshua"</span><span class="o">,</span> <span class="s">"Gafter, Neal"</span><span class="o">)),</span>
                	 <span class="k">new</span> <span class="nc">Book</span><span class="o">(</span><span class="n">title</span> <span class="k">=</span> <span class="s">"Programming in Scala"</span><span class="o">,</span> <span class="n">authors</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">"Odersky, Martin"</span><span class="o">,</span><span class="s">"Spoon, Lex"</span><span class="o">,</span> <span class="s">"Venners, Bill"</span><span class="o">))</span>
  <span class="o">)</span>

  <span class="k">for</span><span class="o">(</span><span class="n">b</span><span class="k">&lt;-</span><span class="n">books</span><span class="o">;</span> <span class="n">a</span><span class="k">&lt;-</span><span class="n">b</span><span class="o">.</span><span class="n">authors</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">startsWith</span><span class="o">(</span><span class="s">"Bloch"</span><span class="o">))</span> <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">title</span>
                                                  <span class="c1">//List(Effective Java, Effective Java2, Java Puzzlers)
</span>  
  <span class="o">(</span><span class="k">for</span><span class="o">{</span><span class="n">b1</span><span class="k">&lt;-</span><span class="n">books</span>
  		<span class="n">b2</span><span class="k">&lt;-</span><span class="n">books</span>
  		<span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">title</span> <span class="o">&lt;</span> <span class="n">b2</span><span class="o">.</span><span class="n">title</span>
  		<span class="n">a1</span><span class="k">&lt;-</span><span class="n">b1</span><span class="o">.</span><span class="n">authors</span>
  		<span class="n">a2</span><span class="k">&lt;-</span><span class="n">b2</span><span class="o">.</span><span class="n">authors</span>
  		<span class="k">if</span> <span class="n">a1</span><span class="o">==</span><span class="n">a2</span>
  		<span class="o">}</span> <span class="k">yield</span> <span class="n">a1</span>
 	<span class="o">).</span><span class="n">distinct</span>                                <span class="c1">//or toSet，结果是List(Bloch, Joshua)
</span> <span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>第一个查询是列出books中作者名字以”Block”开头的书本名字；第二个查询稍微复杂点，是列出books中写出两本以上书的作者的名字，<code class="highlighter-rouge">.distinct</code>或者<code class="highlighter-rouge">toSet</code>是将结果中重复的剔除掉。</p>

<p>我们可以看到Scala的<strong>for-expression</strong>用于数据库查询也十分紧凑明了。数据库查询框架<strong>ScalaQuery</strong>，<strong>Slick</strong>和<strong>Microsoft’s LINQ</strong>都是基于Scala的<strong>for-expression</strong>来实现的。</p>

<p>Scala的<strong>for-expression</strong>的实现是基于<strong>filter</strong>，<strong>map</strong>和<strong>flatMao</strong>这三种高阶函数。本质上来说<strong>for-expression</strong>是语法糖，让开发者代码写起来简单易懂又不失其强大。</p>

<h3 id="section-2">2.3 例子</h3>

<p>我们将所学的Collection数据结构以及可选值和for表达式结合在一起，来解决一个具体问题。</p>

<blockquote>
  <p><strong>号码字母问题</strong>：给定一个数字，返回所有可能的单词。数字和字母的对应关系如下图所示。即”2”-&gt;”ABC”，…,”9”-&gt;”wxyz”。如果我们输入是”7225247386”，其中一个输出是”scala is fun”。</p>
</blockquote>

<p class="img_middle_mid"><img src="/assets/images/posts/2015-10-06/Nokia N70.png" alt="Nokia N70" /></p>

<p>我们用<strong>top-down</strong>一步步思考该如何实现：</p>

<ol>
  <li>
    <p>首先，我们有一个<code class="highlighter-rouge">encode(number:String):Set[String]</code>，输入一个数字，返回最后答案的<code class="highlighter-rouge">Set</code>。因为答案不能有重复，所以<code class="highlighter-rouge">Set</code>比较合适。这个方法的实现主要用到<strong>分而治之</strong>的思想：</p>

    <p>1.1 将数字拆解成两部分，第一部分求解；然后第二部分求解；<br />
 1.2 将结果merge。</p>
  </li>
  <li>
    <p>求解过程中有一个函数<code class="highlighter-rouge">numberToWords(number:String):Set[String]</code>，即给定了一个数字(不可拆分)，输出所有可能的单词。那么如何实现呢，我们设想有一个<code class="highlighter-rouge">val numberToWordsMap: Map[String，List[String]]</code>，任何数字的对应单词都已经存在里面了。那么我们只需要调用这个<code class="highlighter-rouge">Map</code>即可。</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">numberToWordsMap</code>需要我们将已有的单词字典里的每个单词都写成数字<code class="highlighter-rouge">def encodeWord(word:String):Int</code>，然后按照数字归类。</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">def encodeWord(word:String):Int</code>需要实现将字母写成单个数字<code class="highlighter-rouge">def encodeChar(char:Char): Int</code>。</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">def encodeChar(char:Char): Int</code> 需要将上图Nokia键盘的数字转换字母规则转换成字母转换数字规则。</p>
  </li>
  <li>
    <p>课程提供了一个简易字典文件，最后我们将上述所有连接起来，就是最终实现了。见下面代码。</p>
  </li>
</ol>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></td><td class="code"><pre><span class="k">import</span> <span class="nn">scala.io.Source</span>
<span class="k">import</span> <span class="nn">scala.collection.immutable.List</span>
<span class="k">object</span> <span class="nc">lecture7</span> <span class="o">{</span>

  <span class="k">import</span> <span class="nn">scala.io.Source</span>
<span class="k">import</span> <span class="nn">scala.collection.immutable.List</span>
<span class="k">object</span> <span class="nc">lecture7</span> <span class="o">{</span>
          
  <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">"/Users/LAL/Scala/hello-project/src/week6/dict/linux.words"</span><span class="o">)</span>
                                                
  <span class="k">val</span> <span class="n">words</span> <span class="k">=</span> <span class="n">in</span><span class="o">.</span><span class="n">getLines</span><span class="o">.</span><span class="n">toVector</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">word</span><span class="k">=&gt;</span><span class="n">word</span><span class="o">.</span><span class="n">forall</span><span class="o">(</span><span class="n">lt</span><span class="k">=&gt;</span><span class="n">lt</span><span class="o">.</span><span class="n">isLetter</span><span class="o">))</span>
                                                
  <span class="k">val</span> <span class="n">numbToLettsMap</span><span class="k">:</span><span class="kt">Map</span><span class="o">[</span><span class="kt">Char</span>,<span class="kt">String</span><span class="o">]</span><span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="sc">'2'</span><span class="o">-&gt;</span><span class="s">"ABC"</span><span class="o">,</span><span class="sc">'3'</span><span class="o">-&gt;</span><span class="s">"DEF"</span><span class="o">,</span><span class="sc">'4'</span><span class="o">-&gt;</span><span class="s">"GHI"</span><span class="o">,</span><span class="sc">'5'</span><span class="o">-&gt;</span><span class="s">"JKL"</span><span class="o">,</span>
  								<span class="sc">'6'</span><span class="o">-&gt;</span><span class="s">"MNO"</span><span class="o">,</span><span class="sc">'7'</span><span class="o">-&gt;</span><span class="s">"PQRS"</span><span class="o">,</span><span class="sc">'8'</span><span class="o">-&gt;</span><span class="s">"TUV"</span><span class="o">,</span><span class="sc">'9'</span><span class="o">-&gt;</span><span class="s">"WXYZ"</span><span class="o">)</span>
                                                  <span class="c1">//&gt; numbToLettsMap  : Map[Char,String] = Map(8 -&gt; TUV, 4 -&gt; GHI, 9 -&gt; WXYZ, 5 -
</span>                                                  <span class="c1">//| &gt; JKL, 6 -&gt; MNO, 2 -&gt; ABC, 7 -&gt; PQRS, 3 -&gt; DEF)
</span>  <span class="cm">/**Invert the mnem map to give a map from chars 'A'...'Z' to '2'...'9'*/</span>
  <span class="k">val</span> <span class="n">charCode</span><span class="k">:</span><span class="kt">Map</span><span class="o">[</span><span class="kt">Char</span>,<span class="kt">Char</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">((</span><span class="n">numb</span><span class="o">,</span><span class="n">letts</span><span class="o">)</span><span class="k">&lt;-</span><span class="n">numbToLettsMap</span><span class="o">;</span><span class="n">lett</span><span class="k">&lt;-</span><span class="n">letts</span><span class="o">)</span> <span class="k">yield</span> <span class="n">lett</span><span class="o">-&gt;</span><span class="n">numb</span>
                                                  <span class="c1">//&gt; charCode  : Map[Char,Char] = Map(E -&gt; 3, X -&gt; 9, N -&gt; 6, T -&gt; 8, Y -&gt; 9, J 
</span>                                                  <span class="c1">//| -&gt; 5, U -&gt; 8, F -&gt; 3, A -&gt; 2, M -&gt; 6, I -&gt; 4, G -&gt; 4, V -&gt; 8, Q -&gt; 7, L -&gt; 
</span>                                                  <span class="c1">//| 5, B -&gt; 2, P -&gt; 7, C -&gt; 2, H -&gt; 4, W -&gt; 9, K -&gt; 5, R -&gt; 7, O -&gt; 6, D -&gt; 3, 
</span>                                                  <span class="c1">//| Z -&gt; 9, S -&gt; 7)
</span>  <span class="cm">/**Maps a word to the digit string it can represent, e.g. "Java"-&gt;"5282"*/</span>
  <span class="k">def</span> <span class="n">wordCode</span><span class="o">(</span><span class="n">word</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">charCode</span><span class="o">)</span>
                                                  <span class="c1">//&gt; wordCode: (word: String)String
</span>  <span class="cm">/**
  *A map from digit strings to the words that represent them
  *e.g. "5282" -&gt; List("Java","Kata","Lava",...)
  *Note: A missing nuber should map tot he empty set,e.g. "1111" -&gt; List()
  */</span>
  <span class="k">def</span> <span class="n">numbToWordMap</span><span class="k">:</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>,<span class="kt">Vector</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="n">words</span><span class="o">.</span><span class="n">groupBy</span><span class="o">(</span><span class="n">wordCode</span><span class="o">).</span><span class="n">withDefaultValue</span><span class="o">(</span><span class="nc">Vector</span><span class="o">())</span>
                                                  <span class="c1">//&gt; numbToWordMap: =&gt; Map[String,Vector[String]]
</span>  <span class="cm">/**Return all ways to encode a number as a list of words*/</span>
  <span class="k">def</span> <span class="n">encode</span><span class="o">(</span><span class="n">numb</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span><span class="kt">Set</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">numb</span><span class="o">.</span><span class="n">isEmpty</span><span class="o">)</span> <span class="nc">Set</span><span class="o">(</span><span class="nc">List</span><span class="o">())</span>
  <span class="k">else</span><span class="o">{</span>
  	<span class="k">for</span><span class="o">{</span>
  		<span class="n">part</span><span class="k">&lt;-</span><span class="mi">1</span> <span class="n">to</span> <span class="n">numb</span><span class="o">.</span><span class="n">length</span>
  		<span class="n">result</span><span class="k">&lt;-</span><span class="n">numbToWordMap</span><span class="o">(</span><span class="n">numb</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="n">part</span><span class="o">))</span>
  		<span class="n">rest</span><span class="k">&lt;-</span><span class="n">encode</span><span class="o">(</span><span class="n">numb</span><span class="o">.</span><span class="n">drop</span><span class="o">(</span><span class="n">part</span><span class="o">))</span>
  	<span class="o">}</span> <span class="k">yield</span> <span class="n">result</span><span class="o">::</span><span class="n">rest</span>
  <span class="o">}.</span><span class="n">toSet</span>                                         <span class="c1">//&gt; encode: (numb: String)Set[List[String]]
</span>
  <span class="n">println</span><span class="o">(</span><span class="n">encode</span><span class="o">(</span><span class="s">"7225247386"</span><span class="o">))</span>                   <span class="c1">//&gt; Set(List(rack, ah, re, to), List(sack, ah, re, to), List(Scala, ire, to), L
</span>                                                  <span class="c1">//| ist(sack, air, fun), List(rack, air, fun), List(rack, bird, to), List(pack,
</span>                                                  <span class="c1">//|  air, fun), List(pack, ah, re, to), List(pack, bird, to), List(Scala, is, f
</span>                                                  <span class="c1">//| un), List(sack, bird, to))
</span>  <span class="k">def</span> <span class="n">transform</span><span class="o">(</span><span class="n">numb</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span><span class="kt">Set</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">encode</span><span class="o">(</span><span class="n">numb</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">" "</span><span class="o">))</span>
                                                  <span class="c1">//&gt; transform: (numb: String)Set[String]
</span>  <span class="n">println</span><span class="o">(</span><span class="n">transform</span><span class="o">(</span><span class="s">"7225247386"</span><span class="o">))</span>                <span class="c1">//&gt; Set(sack air fun, pack ah re to, pack bird to, Scala ire to, Scala is fun, 
</span>                                                  <span class="c1">//| rack ah re to, pack air fun, sack bird to, rack bird to, sack ah re to, rac
</span>                                                  <span class="c1">//| k air fun)
</span><span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>关于这个例子，有一篇文章<a href="http://page.mi.fu-berlin.de/prechelt/Biblio/jccpprtTR.pdf">An empirical comparison of C, C++, Java, Perl, Python, Rexx, and Tcl for a search/string-processing program</a>专门比较了7种语言实现的不同。其中：</p>

<ol>
  <li>脚本语言用了大约100loc(line of code)；</li>
  <li>非脚本语言用了大约200-300loc。</li>
</ol>

<p>对比一下scala,<strong>20loc</strong>以内解决问题，而且不用担心遍历Collection时的边界条件，实在令我们印象深刻。<strong>Scala</strong>函数式语言的强大可见一斑，这主要依赖基于函数式数据结构实现的Collection的强大且简捷的高阶函数。</p>

<h2 id="assignment">3 Assignment</h2>

<p>本周的作业是写Sentence的Anagram，其中<code class="highlighter-rouge">foldLeft</code>的紧凑在这里得到了良好的体现，本来需要好十几行的代码，用<code class="highlighter-rouge">foldLeft</code>几行就能解决，其中巧妙，需要细细体会。<code class="highlighter-rouge">foldLeft</code>其实是对<code class="highlighter-rouge">monoids</code>的一种应用。<code class="highlighter-rouge">monoids</code>将在后续文章中讨论。</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre>  <span class="cm">/**
   * Returns the list of all subsets of the occurrence list.
   *  This includes the occurrence itself, i.e. `List(('k', 1), ('o', 1))`
   *  is a subset of `List(('k', 1), ('o', 1))`.
   *  It also include the empty subset `List()`.
   *
   *  Example: the subsets of the occurrence list `List(('a', 2), ('b', 2))` are:
   *
   *    List(
   *      List(),
   *      List(('a', 1)),
   *      List(('a', 2)),
   *      List(('b', 1)),
   *      List(('a', 1), ('b', 1)),
   *      List(('a', 2), ('b', 1)),
   *      List(('b', 2)),
   *      List(('a', 1), ('b', 2)),
   *      List(('a', 2), ('b', 2))
   *    )
   *
   *  Note that the order of the occurrence list subsets does not matter -- the subsets
   *  in the example above could have been displayed in some other order.
   */</span>
      
  <span class="k">def</span> <span class="n">combinations</span><span class="o">(</span><span class="n">occurrences</span><span class="k">:</span> <span class="kt">Occurrences</span><span class="o">)</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Occurrences</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">occurrences</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="nc">List</span><span class="o">[</span><span class="kt">Occurrences</span><span class="o">](</span><span class="nc">Nil</span><span class="o">))((</span><span class="n">acc</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">{</span>
        <span class="n">oc</span> <span class="k">&lt;-</span> <span class="n">acc</span> <span class="c1">//oc: List[(Char,Int)]
</span>        <span class="n">x</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">item</span><span class="o">.</span><span class="n">_2</span><span class="o">)</span> <span class="k">yield</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span> <span class="n">i</span><span class="o">)).</span><span class="n">toList</span> <span class="c1">//x: (Char,Int)
</span>      <span class="o">}</span> <span class="k">yield</span> <span class="k">if</span> <span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">_2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">oc</span> <span class="k">else</span> <span class="n">oc</span> <span class="o">++</span> <span class="nc">List</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
    <span class="o">})</span>
  <span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>具体代码见<a href="https://github.com/shunmian/-2_Functional-Programming-in-Scala">这里</a>。</p>

<h2 id="section-3">4 总结</h2>

<p class="img_middle_lg"><img src="/assets/images/posts/2015-10-06/for-expression &amp;&amp; Option.png" alt="for-expression &amp;&amp; Option" /></p>

<h2 id="section-4">5 参考资料</h2>
<ul>
  <li><a href="https://mitpress.mit.edu/sicp/full-text/book/book.html">《Structure and Interpretation of Computer Programs》</a>;</li>
  <li><a href="https://www.youtube.com/watch?v=kkTFx3-duc8">Martin Odersky: Scala with Style</a>;</li>
  <li><a href="https://www.youtube.com/watch?v=ecekSCX3B4Q">SF Scala: Martin Odersky, Scala – the Simple Parts</a>;</li>
  <li><a href="https://www.youtube.com/watch?v=v1IlyzxP6Sg">Programming Languages: Lambda Calculus</a>;</li>
  <li><a href="http://www.defmacro.org/ramblings/fp.html">Functional Programming For The Rest of Us</a>;</li>
</ul>


            <div class="clearfix"></div>
        </div>


    
    <ul class="tag_box list-unstyled list-inline">
      <li><i class="fa fa-folder-open"></i></li>
      
      
      
        <li><a href="http://www.shunmian.me/categories.html#Functional Programming-ref">
          Functional Programming <span>(8)</span>
          
        </a></li>
      
      
    </ul>
    

    
    <ul class="list-inline">
      <li><i class="fa fa-tags"></i></li>
      
      
      
        <li>
          <a href="http://www.shunmian.me/tags.html#OOP&&FP-ref">
          OOP&&FP <span>(5)</span>
          
          </a>
        </li>
      
      
      
    </ul>
    

<hr />
<div >
    <section class="col-sm-7">
        <h4>Share Post</h4>
        <a class="btn btn-default btn-sm" href="http://twitter.com/share?text=FP in Scala(二)：OOP和λ-演算的结合 Part III：可选值，for-exp&via=Wanderl29817400" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fa fa-twitter fa-sm"></i>
        Twitter
        </a>

        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-sm"></i>
          Facebook
        </a>

        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-sm"></i>
          Google+
        </a>
    </section>

    <section class="col-sm-5">
        <img src = "https://www.gravatar.com/avatar/02eefecba7f0b21939d12a37f94bf5df" class="img-rounded" />
        <h4>Shunmian</h4>
        <p class="author-bio">节物风光不相待，桑田碧海须臾改，唯有美食和code不可辜负。</p>

    </section>

</div>
<div class="clearfix"></div>

<ul class="pager">
    
    <li class="previous"><a href="http://www.shunmian.me/functional%20programming/2015/10/05/Functional-Programming-in-Scala(%E4%BA%8C)_OOP%E5%92%8C%CE%BB-%E6%BC%94%E7%AE%97%E7%9A%84%E7%BB%93%E5%90%88-Part-II-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84Collection.html" title= "">&larr; Previous</a></li>
    
    
    <li class="next">"<a href="http://www.shunmian.me/functional%20programming/2015/10/07/Functional-Programming-in-Scala(%E4%BA%8C)_OOP%E5%92%8C%CE%BB-%E6%BC%94%E7%AE%97%E7%9A%84%E7%BB%93%E5%90%88-Part-IV-%E6%B5%81.html" title= "FP in Scala(二)：OOP和λ-演算的结合 Part IV：Stream(流)">Next &rarr;</a></li>
    
</ul>

    <hr />
    
    <section class="comments" style="margin-top:15px;">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shunmianjohnson'; // required: replace example with your forum shortname
        if(disqus_shortname){
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        }
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
    
    </div>
    <div class="col-sm-1sidebar-2"></div>
    <div class="clearfix"></div>
</article>
<div class="clearfix"></div>


                <div class="footer">
                    <footer>
                        <hr />
                        <p> &copy: 2015 Shunmian with jekyll. Theme: <a href="https://github.com/dbtek/dbyll"dbyll</a> by dbtek.
                        </p>
                    </footer>
                </div>
            </div>
        </div>
    </div>


    <script src="/assets/js/jquery-2.2.0.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/script.js"></script>
    <script type="text/javascript">

$youziku.load(".sidebar_bio", "bdcc72b8235345649b02c123dac5610b", "SiYuan-ExtraLight");


   $youziku.draw();
</script>

</body>

</html>

